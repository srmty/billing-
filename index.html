<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing System with Inventory</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            border-bottom: 1px solid #ccc;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: #f4f4f4;
            cursor: pointer;
            margin-right: 5px;
            border: 1px solid #ccc;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            margin-bottom: -1px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .btn {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #45a049;
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        table th, table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        table th {
            background-color: #f4f4f4;
        }
        
        /* Item Actions */
        .item-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .remove-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
        }
        
        /* Initially show first tab */
        #customer-tab {
            display: block;
        }
        
        /* Bill Print Styles */
        #print-area {
            display: none; /* Initially hidden */
            background-color: white;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid #ddd;
        }
        
        .bill-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: flex-start;
        }
        
        .company-info {
            flex: 1;
        }
        
        .bill-info {
            flex: 1;
            text-align: right;
        }
        
        .bill-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #2196F3;
        }
        
        .customer-section {
            margin-bottom: 20px;
        }
        
        .bill-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .bill-table th, .bill-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        .bill-table th {
            background-color: #f4f4f4;
        }
        
        .bill-summary {
            width: 40%;
            margin-left: auto;
            border-collapse: collapse;
        }
        
        .bill-summary td {
            padding: 5px;
            border: none;
        }
        
        .bill-summary td:last-child {
            text-align: right;
            font-weight: bold;
        }
        
        .bill-footer {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        
        /* Align right for numbers */
        .text-right {
            text-align: right;
        }
        
        /* CSV Import Styles */
        .csv-import-container {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .csv-format-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .csv-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .csv-upload-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .csv-preview {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .preview-item {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .confirm-import-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            margin-right: 10px;
        }
        
        .cancel-import-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* Print specific styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Billing System with Inventory</h1>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="tab active" data-tab="customer">Customer</div>
            <div class="tab" data-tab="items">Items</div>
            <div class="tab" data-tab="inventory">Inventory</div>
            <div class="tab" data-tab="settings">Settings</div>
        </div>
        
        <!-- Customer Tab -->
        <div id="customer-tab" class="tab-content">
            <h2>Customer Information</h2>
            <div class="form-group">
                <label for="customer-name">Customer Name *</label>
                <input type="text" id="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-phone">Phone Number</label>
                <input type="tel" id="customer-phone">
            </div>
            <div class="form-group">
                <label for="customer-email">Email</label>
                <input type="email" id="customer-email">
            </div>
            <div class="form-group">
                <label for="customer-address">Address</label>
                <textarea id="customer-address" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="bill-number">Bill Number *</label>
                <input type="text" id="bill-number" required>
            </div>
            <div class="form-group">
                <label for="payment-method">Payment Method</label>
                <select id="payment-method">
                    <option value="Cash">Cash</option>
                    <option value="Credit Card">Credit Card</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                    <option value="Check">Check</option>
                </select>
            </div>
            <button id="next-to-items" class="btn">Next: Add Items</button>
        </div>
        
        <!-- Items Tab -->
        <div id="items-tab" class="tab-content">
            <div class="item-form">
                <h2 id="item-form-title">Add Item</h2>
                <div class="form-group">
                    <label for="item-selection">Select from Inventory</label>
                    <select id="item-selection">
                        <option value="-1">-- Select Item --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="item-name">Item Name *</label>
                    <input type="text" id="item-name" required>
                </div>
                <div class="form-group">
                    <label for="item-description">Description</label>
                    <textarea id="item-description" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="item-quantity">Quantity *</label>
                    <input type="number" id="item-quantity" value="1" min="1" required>
                </div>
                <div class="form-group">
                    <label for="item-price">Price *</label>
                    <input type="number" id="item-price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="item-tax">Tax Rate (%)</label>
                    <input type="number" id="item-tax" step="0.1" value="7.5">
                </div>
                <div class="form-group">
                    <label for="item-warranty">Warranty (months)</label>
                    <input type="number" id="item-warranty" value="0" min="0">
                </div>
                <div class="form-group">
                    <label for="item-serial">Serial Number</label>
                    <input type="text" id="item-serial">
                </div>
                <input type="hidden" id="edit-item-index" value="-1">
                <button id="add-item" class="btn">Add Item</button>
                <button id="update-item" class="btn" style="display: none;">Update Item</button>
                <button id="cancel-edit" class="btn" style="display: none; background-color: #f44336;">Cancel</button>
            </div>
            
            <h2>Items in Bill</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Tax</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="items-body">
                    <!-- Items will be added here -->
                </tbody>
            </table>
            
            <div class="bill-summary">
                <table style="width: 40%; margin-left: auto;">
                    <tr>
                        <td>Subtotal:</td>
                        <td id="subtotal-amount" class="text-right">$0.00</td>
                    </tr>
                    <tr>
                        <td>Tax:</td>
                        <td id="tax-amount" class="text-right">$0.00</td>
                    </tr>
                    <tr>
                        <td><strong>Total:</strong></td>
                        <td id="total-amount" class="text-right"><strong>$0.00</strong></td>
                    </tr>
                </table>
            </div>
            
            <div style="margin-top: 20px;">
                <button id="generate-bill" class="btn">Generate Bill</button>
                <button id="reset-bill" class="btn" style="background-color: #f44336;">Reset</button>
            </div>
        </div>
        
        <!-- Inventory Tab -->
        <div id="inventory-tab" class="tab-content">
            <h2>Inventory Items</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Tax Rate</th>
                        <th>Warranty</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="inventory-body">
                    <!-- Inventory items will be added here -->
                </tbody>
            </table>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <h2>Company Information</h2>
            <div class="form-group">
                <label for="company-name">Company Name</label>
                <input type="text" id="company-name" value="Tech Solutions Inc.">
            </div>
            <div class="form-group">
                <label for="company-street">Street Address</label>
                <input type="text" id="company-street" value="123 Tech Street, Silicon Valley">
            </div>
            <div class="form-group">
                <label for="company-city">City, State, ZIP</label>
                <input type="text" id="company-city" value="CA 94043">
            </div>
            <div class="form-group">
                <label for="company-phone">Phone</label>
                <input type="tel" id="company-phone" value="(555) 123-4567">
            </div>
            <div class="form-group">
                <label for="company-email">Email</label>
                <input type="email" id="company-email" value="info@techsolutions.com">
            </div>
            <div class="form-group">
                <label for="company-website">Website</label>
                <input type="url" id="company-website" value="www.techsolutions.com">
            </div>
            
            <h2>Default Settings</h2>
            <div class="form-group">
                <label for="default-tax">Default Tax Rate (%)</label>
                <input type="number" id="default-tax" value="7.5" step="0.1">
            </div>
            <div class="form-group">
                <label for="terms-conditions">Terms & Conditions</label>
                <textarea id="terms-conditions" rows="5">1. Payment is due within 30 days.
2. Warranty is only valid with the original receipt.
3. Returns accepted within 14 days of purchase.
4. All prices are subject to change without notice.</textarea>
            </div>
            
            <button id="save-settings" class="btn">Save Settings</button>
            <!-- CSV Import will be added here -->
        </div>
        
        <!-- Print Area -->
        <div id="print-area" style="display: none;">
            <div class="bill-header">
                <div class="company-info">
                    <h2 id="bill-company-name">Tech Solutions Inc.</h2>
                    <div id="company-address">
                        123 Tech Street, Silicon Valley, CA 94043<br>
                        Phone: (555) 123-4567<br>
                        Email: info@techsolutions.com<br>
                        Website: www.techsolutions.com
                    </div>
                </div>
                <div class="bill-info">
                    <div class="bill-title">INVOICE</div>
                    <div><strong>Invoice #:</strong> <span id="bill-no"></span></div>
                    <div><strong>Date:</strong> <span id="bill-date"></span></div>
                    <div><strong>Payment Method:</strong> <span id="bill-payment"></span></div>
                </div>
            </div>
            
            <div class="customer-section">
                <h3>Bill To:</h3>
                <div><strong>Name:</strong> <span id="bill-customer-name"></span></div>
                <div><strong>Phone:</strong> <span id="bill-customer-phone"></span></div>
                <div><strong>Email:</strong> <span id="bill-customer-email"></span></div>
                <div><strong>Address:</strong> <span id="bill-customer-address"></span></div>
            </div>
            
            <table class="bill-table">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Item Description</th>
                        <th>Serial #</th>
                        <th>Warranty</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Tax</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="bill-items-body">
                    <!-- Bill items will be added here -->
                </tbody>
            </table>
            
            <table class="bill-summary">
                <tr>
                    <td>Subtotal:</td>
                    <td id="bill-subtotal"></td>
                </tr>
                <tr>
                    <td>Tax:</td>
                    <td id="bill-tax"></td>
                </tr>
                <tr>
                    <td><strong>Total:</strong></td>
                    <td id="bill-total"></td>
                </tr>
            </table>
            
            <div class="bill-footer">
                <h3>Terms & Conditions</h3>
                <div id="bill-terms"></div>
            </div>
            
            <div class="no-print" style="margin-top: 20px; text-align: center;">
                <button id="print-bill" class="btn">Print Bill</button>
            </div>
        </div>
        
        <div id="current-date" style="margin-top: 20px; text-align: right; font-size: 0.8em;"></div>
    </div>

    <script>
        // Define the inventory items array globally
        let inventoryItems = [];
        // Initialize items array
        let items = [];
        let subtotal = 0;
        let taxTotal = 0;
        let grandTotal = 0;
        let editingItemIndex = -1;

        // Function to parse CSV data into inventory items
        function parseCSVInventory(csvText) {
            // Split the CSV text into lines
            const lines = csvText.trim().split('\n');
            
            // Extract headers from the first line
            const headers = lines[0].split(',').map(header => header.trim());
            
            // Process each line (skipping the header)
            const items = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                // Skip empty lines
                if (line.trim() === '') continue;
                
                // Split the line by comma, but handle cases where commas are within quotes
                const values = [];
                let currentValue = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"' && (j === 0 || line[j-1] !== '\\')) {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(currentValue.trim());
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                
                // Add the last value
                values.push(currentValue.trim());
                
                // Create an object from the headers and values
                const item = {};
                for (let j = 0; j < headers.length; j++) {
                    // Remove quotes if present
                    let value = values[j] || '';
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }
                    
                    // Convert numeric values
                    if (headers[j] === 'price' || headers[j] === 'taxRate') {
                        item[headers[j]] = parseFloat(value) || 0;
                    } else if (headers[j] === 'warranty') {
                        item[headers[j]] = parseInt(value) || 0;
                    } else {
                        item[headers[j]] = value;
                    }
                }
                
                items.push(item);
            }
            
            return items;
        }

        // Add function to load CSV from a GitHub URL
        async function loadInventoryFromGitHub() {
            const githubCsvUrl = 'https://raw.githubusercontent.com/srmty/billing-/main/test.csv';
            
            try {
                const response = await fetch(githubCsvUrl);
                if (!response.ok) {
                    throw new Error(`Failed to fetch CSV: ${response.status}`);
                }
                
                const csvContent = await response.text();
                const items = parseCSVInventory(csvContent);
                
                // Add the parsed items to the inventory
                inventoryItems = items;
                
                // Update the UI
                updateInventoryTable();
                updateItemSelectionDropdown();
                
                console.log(`Successfully loaded ${items.length} inventory items from GitHub.`);
            } catch (error) {
                console.error('Error loading inventory from GitHub:', error);
                // You could show a UI notification here if desired
            }
        }

        // Function to add a CSV import feature
        function addCSVImportFeature() {
            // Create the import container
            const importContainer = document.createElement('div');
            importContainer.className = 'csv-import-container';
            
            // Create the input and button elements
            importContainer.innerHTML = `
                <h3>Import Inventory from CSV</h3>
                <p class="csv-format-info">CSV Format: name,description,price,taxRate,warranty</p>
                <div class="csv-input-group">
                    <input type="file" id="csv-file-input" accept=".csv" />
                    <button id="upload-csv" class="csv-upload-btn">Upload CSV</button>
                </div>
                <div id="csv-preview" class="csv-preview" style="display: none;">
                    <h4>Preview of Imported Items (<span id="preview-count">0</span>)</h4>
                    <div id="preview-content" class="preview-content"></div>
                    <button id="confirm-import" class="confirm-import-btn">Confirm Import</button>
                    <button id="cancel-import" class="cancel-import-btn">Cancel</button>
                </div>
            `;
            
            return importContainer;
        }

        // Function to update the item selection dropdown with current inventory
        function updateItemSelectionDropdown() {
            const select = document.getElementById('item-selection');
            if (!select) return;
            
            // Clear current options except the first (default) option
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Add inventory items as options
            inventoryItems.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${item.name} - $${item.price.toFixed(2)}`;
                select.appendChild(option);
            });
        }

        // Function to update the inventory table
        function updateInventoryTable() {
            const tableBody = document.getElementById('inventory-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            inventoryItems.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                
                const descCell = document.createElement('td');
                descCell.textContent = item.description.length > 30 ? 
                    item.description.substring(0, 30) + '...' : 
                    item.description;
                
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + item.price.toFixed(2);
                priceCell.className = 'text-right';
                
                const taxCell = document.createElement('td');
                taxCell.textContent = item.taxRate + '%';
                taxCell.className = 'text-right';
                
                const warrantyCell = document.createElement('td');
                warrantyCell.textContent = item.warranty > 0 ? 
                    item.warranty + ' months' : 'None';
                
                const actionsCell = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                // Add to bill button
                const addButton = document.createElement('button');
                addButton.className = 'edit-btn';
                addButton.textContent = 'Add to Bill';
                addButton.addEventListener('click', function() {
                    // Populate the item form with this inventory item
                    const itemName = document.getElementById('item-name');
                    if (itemName) itemName.value = item.name;
                    
                    const itemDescription = document.getElementById('item-description');
                    if (itemDescription) itemDescription.value = item.description;
                    
                    const itemPrice = document.getElementById('item-price');
                    if (itemPrice) itemPrice.value = item.price;
                    
                    const itemTax = document.getElementById('item-tax');
                    if (itemTax) itemTax.value = item.taxRate;
                    
                    const itemWarranty = document.getElementById('item-warranty');
                    if (itemWarranty) itemWarranty.value = item.warranty;
                    
                    // Switch to items tab
                    const itemsTab = document.querySelector('.tab[data-tab="items"]');
                    if (itemsTab) itemsTab.click();
                });
                
                actionsDiv.appendChild(addButton);
                actionsCell.appendChild(actionsDiv);
                
                row.appendChild(nameCell);
                row.appendChild(descCell);
                row.appendChild(priceCell);
                row.appendChild(taxCell);
                row.appendChild(warrantyCell);
                row.appendChild(actionsCell);
                
                tableBody.appendChild(row);
            });
        }

        // Display current date
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-US', {
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            });
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = formattedDate;
            }
            return formattedDate;
        }

        // Setup event listeners for CSV import
        function setupCSVImportListeners() {
            const fileInput = document.getElementById('csv-file-input');
            const uploadButton = document.getElementById('upload-csv');
            const previewDiv = document.getElementById('csv-preview');
            const previewContent = document.getElementById('preview-content');
            const previewCount = document.getElementById('preview-count');
            const confirmButton = document.getElementById('confirm-import');
            const cancelButton = document.getElementById('cancel-import');
            
            let parsedItems = [];
            
            uploadButton.addEventListener('click', function() {
                const file = fileInput.files[0];
                if (!file) {
                    alert('Please select a CSV file first.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvContent = e.target.result;
                    parsedItems = parseCSVInventory(csvContent);
                    
                    // Show preview
                    previewDiv.style.display = 'block';
                    previewContent.innerHTML = '';
                    previewCount.textContent = parsedItems.length;
                    
                    // Display first 5 items (or fewer if less exist)
                    const previewLimit = Math.min(parsedItems.length, 5);
                    for (let i = 0; i < previewLimit; i++) {
                        const item = parsedItems[i];
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'preview-item';
                        itemDiv.textContent = `${item.name} - $${item.price.toFixed(2)} (${item.taxRate}% Tax, ${item.warranty} months warranty)`;
                        previewContent.appendChild(itemDiv);
                    }
                    
                    if (parsedItems.length > 5) {
                        const moreDiv = document.createElement('div');
                        moreDiv.className = 'preview-item';
                        moreDiv.textContent = `... and ${parsedItems.length - 5} more items`;
                        previewContent.appendChild(moreDiv);
                    }
                };

                reader.readAsText(file);
            });

            confirmButton.addEventListener('click', function() {
                // Add the parsed items to the inventory
                inventoryItems = inventoryItems.concat(parsedItems);
                
                // Update the UI
                updateInventoryTable();
                updateItemSelectionDropdown();
                
                // Reset and hide the preview
                previewDiv.style.display = 'none';
                fileInput.value = '';
                
                alert(`Successfully imported ${parsedItems.length} inventory items.`);
                parsedItems = [];
            });

            cancelButton.addEventListener('click', function() {
                // Reset and hide the preview
                previewDiv.style.display = 'none';
                fileInput.value = '';
                parsedItems = [];
            });
        }

        // Calculate total for an item
        function calculateItemTotal(price, quantity, taxRate) {
            const itemSubtotal = price * quantity;
            const itemTax = itemSubtotal * (taxRate / 100);
            return {
                subtotal: itemSubtotal,
                tax: itemTax,
                total: itemSubtotal + item
                subtotal: itemSubtotal,
                tax: itemTax,
                total: itemSubtotal + itemTax
            };
        }

        // Update the totals display
        function updateTotals() {
            // Calculate totals from items array
            subtotal = 0;
            taxTotal = 0;
            grandTotal = 0;
            
            items.forEach(item => {
                subtotal += item.subtotal;
                taxTotal += item.tax;
            });
            
            grandTotal = subtotal + taxTotal;
            
            // Update display
            document.getElementById('subtotal-amount').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('tax-amount').textContent = '$' + taxTotal.toFixed(2);
            document.getElementById('total-amount').textContent = '$' + grandTotal.toFixed(2);
        }

        // Add item to the bill
        function addItem() {
            const nameInput = document.getElementById('item-name');
            const descInput = document.getElementById('item-description');
            const qtyInput = document.getElementById('item-quantity');
            const priceInput = document.getElementById('item-price');
            const taxInput = document.getElementById('item-tax');
            const warrantyInput = document.getElementById('item-warranty');
            const serialInput = document.getElementById('item-serial');
            
            // Validate required fields
            if (!nameInput.value || !qtyInput.value || !priceInput.value) {
                alert('Please fill in all required fields (Name, Quantity, and Price)');
                return;
            }
            
            const name = nameInput.value;
            const description = descInput.value;
            const quantity = parseInt(qtyInput.value);
            const price = parseFloat(priceInput.value);
            const taxRate = parseFloat(taxInput.value);
            const warranty = parseInt(warrantyInput.value);
            const serial = serialInput.value;
            
            // Calculate totals
            const { subtotal, tax, total } = calculateItemTotal(price, quantity, taxRate);
            
            // Create new item object
            const newItem = {
                name,
                description,
                quantity,
                price,
                taxRate,
                warranty,
                serial,
                subtotal,
                tax,
                total
            };
            
            // Add to items array
            if (editingItemIndex >= 0) {
                // Update existing item
                items[editingItemIndex] = newItem;
                editingItemIndex = -1;
                
                // Reset UI
                document.getElementById('add-item').style.display = 'inline-block';
                document.getElementById('update-item').style.display = 'none';
                document.getElementById('cancel-edit').style.display = 'none';
                document.getElementById('item-form-title').textContent = 'Add Item';
            } else {
                // Add new item
                items.push(newItem);
            }
            
            // Clear form
            nameInput.value = '';
            descInput.value = '';
            qtyInput.value = '1';
            priceInput.value = '';
            taxInput.value = document.getElementById('default-tax').value;
            warrantyInput.value = '0';
            serialInput.value = '';
            document.getElementById('edit-item-index').value = '-1';
            
            // Update the item list and totals
            updateItemsList();
            updateTotals();
        }

        // Edit an item
        function editItem(index) {
            const item = items[index];
            
            // Populate form fields
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-description').value = item.description;
            document.getElementById('item-quantity').value = item.quantity;
            document.getElementById('item-price').value = item.price;
            document.getElementById('item-tax').value = item.taxRate;
            document.getElementById('item-warranty').value = item.warranty;
            document.getElementById('item-serial').value = item.serial;
            document.getElementById('edit-item-index').value = index;
            
            // Update UI
            document.getElementById('add-item').style.display = 'none';
            document.getElementById('update-item').style.display = 'inline-block';
            document.getElementById('cancel-edit').style.display = 'inline-block';
            document.getElementById('item-form-title').textContent = 'Edit Item';
            
            editingItemIndex = index;
        }

        // Remove an item
        function removeItem(index) {
            if (confirm('Are you sure you want to remove this item?')) {
                items.splice(index, 1);
                updateItemsList();
                updateTotals();
                
                // If we were editing this item, reset the form
                if (editingItemIndex === index) {
                    document.getElementById('add-item').style.display = 'inline-block';
                    document.getElementById('update-item').style.display = 'none';
                    document.getElementById('cancel-edit').style.display = 'none';
                    document.getElementById('item-form-title').textContent = 'Add Item';
                    
                    document.getElementById('item-name').value = '';
                    document.getElementById('item-description').value = '';
                    document.getElementById('item-quantity').value = '1';
                    document.getElementById('item-price').value = '';
                    document.getElementById('item-tax').value = document.getElementById('default-tax').value;
                    document.getElementById('item-warranty').value = '0';
                    document.getElementById('item-serial').value = '';
                    document.getElementById('edit-item-index').value = '-1';
                    
                    editingItemIndex = -1;
                }
            }
        }

        // Update the items list in the UI
        function updateItemsList() {
            const tableBody = document.getElementById('items-body');
            tableBody.innerHTML = '';
            
            items.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                
                const descCell = document.createElement('td');
                descCell.textContent = item.description.length > 20 ? 
                    item.description.substring(0, 20) + '...' : 
                    item.description;
                
                const qtyCell = document.createElement('td');
                qtyCell.textContent = item.quantity;
                
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + item.price.toFixed(2);
                priceCell.className = 'text-right';
                
                const taxCell = document.createElement('td');
                taxCell.textContent = item.taxRate + '%';
                
                const totalCell = document.createElement('td');
                totalCell.textContent = '$' + item.total.toFixed(2);
                totalCell.className = 'text-right';
                
                const actionsCell = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                const editButton = document.createElement('button');
                editButton.className = 'edit-btn';
                editButton.textContent = 'Edit';
                editButton.addEventListener('click', () => editItem(index));
                
                const removeButton = document.createElement('button');
                removeButton.className = 'remove-btn';
                removeButton.textContent = 'Remove';
                removeButton.addEventListener('click', () => removeItem(index));
                
                actionsDiv.appendChild(editButton);
                actionsDiv.appendChild(removeButton);
                actionsCell.appendChild(actionsDiv);
                
                row.appendChild(nameCell);
                row.appendChild(descCell);
                row.appendChild(qtyCell);
                row.appendChild(priceCell);
                row.appendChild(taxCell);
                row.appendChild(totalCell);
                row.appendChild(actionsCell);
                
                tableBody.appendChild(row);
            });
        }

        // Generate the bill
        function generateBill() {
            // Validate required fields
            const customerName = document.getElementById('customer-name').value;
            const billNumber = document.getElementById('bill-number').value;
            
            if (!customerName) {
                alert('Please enter customer name.');
                return;
            }
            
            if (!billNumber) {
                alert('Please enter bill number.');
                return;
            }
            
            if (items.length === 0) {
                alert('Please add at least one item to the bill.');
                return;
            }
            
            // Fill bill information
            document.getElementById('bill-company-name').textContent = document.getElementById('company-name').value;
            document.getElementById('company-address').innerHTML = 
                document.getElementById('company-street').value + '<br>' +
                document.getElementById('company-city').value + '<br>' +
                'Phone: ' + document.getElementById('company-phone').value + '<br>' +
                'Email: ' + document.getElementById('company-email').value + '<br>' +
                'Website: ' + document.getElementById('company-website').value;
            
            document.getElementById('bill-no').textContent = billNumber;
            document.getElementById('bill-date').textContent = setCurrentDate();
            document.getElementById('bill-payment').textContent = document.getElementById('payment-method').value;
            
            document.getElementById('bill-customer-name').textContent = customerName;
            document.getElementById('bill-customer-phone').textContent = document.getElementById('customer-phone').value;
            document.getElementById('bill-customer-email').textContent = document.getElementById('customer-email').value;
            document.getElementById('bill-customer-address').textContent = document.getElementById('customer-address').value;
            
            // Fill bill items
            const billItemsBody = document.getElementById('bill-items-body');
            billItemsBody.innerHTML = '';
            
            items.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const numCell = document.createElement('td');
                numCell.textContent = index + 1;
                
                const descCell = document.createElement('td');
                descCell.innerHTML = `<strong>${item.name}</strong><br>${item.description}`;
                
                const serialCell = document.createElement('td');
                serialCell.textContent = item.serial || '-';
                
                const warrantyCell = document.createElement('td');
                warrantyCell.textContent = item.warranty > 0 ? item.warranty + ' months' : 'None';
                
                const qtyCell = document.createElement('td');
                qtyCell.textContent = item.quantity;
                qtyCell.className = 'text-right';
                
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + item.price.toFixed(2);
                priceCell.className = 'text-right';
                
                const taxCell = document.createElement('td');
                taxCell.textContent = item.taxRate + '%';
                taxCell.className = 'text-right';
                
                const amountCell = document.createElement('td');
                amountCell.textContent = '$' + item.total.toFixed(2);
                amountCell.className = 'text-right';
                
                row.appendChild(numCell);
                row.appendChild(descCell);
                row.appendChild(serialCell);
                row.appendChild(warrantyCell);
                row.appendChild(qtyCell);
                row.appendChild(priceCell);
                row.appendChild(taxCell);
                row.appendChild(amountCell);
                
                billItemsBody.appendChild(row);
            });
            
            // Fill bill totals
            document.getElementById('bill-subtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('bill-tax').textContent = '$' + taxTotal.toFixed(2);
            document.getElementById('bill-total').textContent = '$' + grandTotal.toFixed(2);
            
            // Set terms and conditions
            document.getElementById('bill-terms').innerHTML = document.getElementById('terms-conditions').value.replace(/\n/g, '<br>');
            
            // Show print area
            document.getElementById('print-area').style.display = 'block';
            
            // Scroll to print area
            document.getElementById('print-area').scrollIntoView({ behavior: 'smooth' });
        }

        // Print the bill
        function printBill() {
            window.print();
        }

        // Reset the form
        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-email').value = '';
                document.getElementById('customer-address').value = '';
                document.getElementById('bill-number').value = '';
                
                items = [];
                updateItemsList();
                updateTotals();
                
                document.getElementById('print-area').style.display = 'none';
                
                // Reset the item form
                document.getElementById('item-name').value = '';
                document.getElementById('item-description').value = '';
                document.getElementById('item-quantity').value = '1';
                document.getElementById('item-price').value = '';
                document.getElementById('item-tax').value = document.getElementById('default-tax').value;
                document.getElementById('item-warranty').value = '0';
                document.getElementById('item-serial').value = '';
                document.getElementById('edit-item-index').value = '-1';
                
                document.getElementById('add-item').style.display = 'inline-block';
                document.getElementById('update-item').style.display = 'none';
                document.getElementById('cancel-edit').style.display = 'none';
                document.getElementById('item-form-title').textContent = 'Add Item';
                
                editingItemIndex = -1;
                
                // Switch to customer tab
                document.querySelector('.tab[data-tab="customer"]').click();
            }
        }

        // Save settings
        function saveSettings() {
            alert('Settings saved successfully!');
        }

        // Tab switching functionality
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Hide all contents
                    contents.forEach(content => content.style.display = 'none');
                    
                    // Activate clicked tab
                    this.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-tab').style.display = 'block';
                });
            });
        }

        // When item is selected from dropdown
        function handleItemSelection() {
            const select = document.getElementById('item-selection');
            const selectedIndex = parseInt(select.value);
            
            if (selectedIndex >= 0) {
                const selectedItem = inventoryItems[selectedIndex];
                
                document.getElementById('item-name').value = selectedItem.name;
                document.getElementById('item-description').value = selectedItem.description;
                document.getElementById('item-price').value = selectedItem.price;
                document.getElementById('item-tax').value = selectedItem.taxRate;
                document.getElementById('item-warranty').value = selectedItem.warranty;
                
                // Reset the dropdown
                select.value = -1;
            }
        }

        // Initialize the app
        function initApp() {
            // Set current date
            setCurrentDate();
            
            // Setup tabs
            setupTabs();
            
            // Set up event listeners
            document.getElementById('next-to-items').addEventListener('click', function() {
                document.querySelector('.tab[data-tab="items"]').click();
            });
            
            document.getElementById('add-item').addEventListener('click', addItem);
            document.getElementById('update-item').addEventListener('click', addItem);
            document.getElementById('cancel-edit').addEventListener('click', function() {
                // Reset item form
                document.getElementById('item-name').value = '';
                document.getElementById('item-description').value = '';
                document.getElementById('item-quantity').value = '1';
                document.getElementById('item-price').value = '';
                document.getElementById('item-tax').value = document.getElementById('default-tax').value;
                document.getElementById('item-warranty').value = '0';
                document.getElementById('item-serial').value = '';
                document.getElementById('edit-item-index').value = '-1';
                editingItemIndex = -1;
                
                // Reset UI
                document.getElementById('add-item').style.display = 'inline-block';
                document.getElementById('update-item').style.display = 'none';
                document.getElementById('cancel-edit').style.display = 'none';
                document.getElementById('item-form-title').textContent = 'Add Item';
            });
            
            document.getElementById('generate-bill').addEventListener('click', generateBill);
            document.getElementById('print-bill').addEventListener('click', printBill);
            document.getElementById('reset-bill').addEventListener('click', resetForm);
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            
            document.getElementById('item-selection').addEventListener('change', handleItemSelection);
            
            // Set default tax rate from settings
            document.getElementById('item-tax').value = document.getElementById('default-tax').value;
            
            // Add CSV import container to settings tab
            const settingsTab = document.getElementById('settings-tab');
            const csvImportContainer = addCSVImportFeature();
            settingsTab.appendChild(csvImportContainer);
            
            // Setup CSV import listeners
            setupCSVImportListeners();
            
            // Load sample inventory data
            // Sample inventory items
            inventoryItems = [
                {
                    name: 'Laptop',
                    description: 'High-performance laptop with 16GB RAM and 512GB SSD',
                    price: 999.99,
                    taxRate: 7.5,
                    warranty: 12
                },
                {
                    name: 'Monitor',
                    description: '27-inch 4K monitor',
                    price: 349.99,
                    taxRate: 7.5,
                    warranty: 24
                },
                {
                    name: 'Keyboard',
                    description: 'Mechanical gaming keyboard',
                    price: 129.99,
                    taxRate: 7.5,
                    warranty: 12
                },
                {
                    name: 'Mouse',
                    description: 'Wireless optical mouse',
                    price: 49.99,
                    taxRate: 7.5,
                    warranty: 6
                },
                {
                    name: 'Headphones',
                    description: 'Noise-cancelling Bluetooth headphones',
                    price: 199.99,
                    taxRate: 7.5,
                    warranty: 12
                }
            ];
            
            // Update inventory table and dropdown
            updateInventoryTable();
            updateItemSelectionDropdown();
            
            // Attempt to load inventory from GitHub (commented out for now)
            // loadInventoryFromGitHub();
        }

        // Initialize when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
