<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun Qwin Enterprises - Billing App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f7f7;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #555555;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        .panel {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
        button {
            background-color: #666666;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #444444;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .total-row {
            font-weight: bold;
            background-color: #f9f9f9;
        }
        .actions {
            display: flex;
            margin-top: 20px;
        }
        .item-actions {
            display: flex;
            gap: 5px;
        }
        .item-actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        .remove-btn {
            background-color: #cc5555;
        }
        .remove-btn:hover {
            background-color: #aa4444;
        }
        .edit-btn {
            background-color: #5555cc;
        }
        .edit-btn:hover {
            background-color: #4444aa;
        }
        .update-btn {
            background-color: #55aa55;
        }
        .update-btn:hover {
            background-color: #448844;
        }
        .cancel-btn {
            background-color: #888888;
        }
        .cancel-btn:hover {
            background-color: #666666;
        }
        .print-preview {
            background-color: white;
            padding: 20px;
            border: 1px solid #ddd;
            margin-top: 20px;
            display: none;
        }
        .bill-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #555555;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .company-info {
            font-size: 14px;
        }
        .company-name {
            font-size: 20px;
            font-weight: bold;
            color: #555555;
        }
        .bill-title {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        .customer-info {
            margin-bottom: 20px;
        }
        .summary {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .summary-table {
            width: 300px;
        }
        .footer {
            margin-top: 50px;
            text-align: center;
            font-size: 14px;
            color: #777;
        }
        .company-settings {
            margin-top: 10px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 15px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            cursor: pointer;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tax-settings {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .tax-settings label {
            margin-right: 10px;
            display: inline-block;
        }
        .tax-settings input {
            width: 80px;
        }
        .warranty-info {
            border-top: 1px dashed #ddd;
            margin-top: 20px;
            padding-top: 10px;
        }
        /* Additional styling for new color scheme */
        .header {
            background: linear-gradient(to right, #555555, #777777);
        }
        #generate-bill {
            background-color: #4a7c59;
        }
        #generate-bill:hover {
            background-color: #3d6b4c;
        }
        #print-bill {
            background-color: #746c70;
        }
        #print-bill:hover {
            background-color: #635b5f;
        }
        #save-pdf {
            background-color: #7a754e;
        }
        #save-pdf:hover {
            background-color: #68643e;
        }
        #reset-bill {
            background-color: #a15e49;
        }
        #reset-bill:hover {
            background-color: #8d4e3a;
        }
        #save-settings {
            background-color: #4f6d7a;
        }
        #save-settings:hover {
            background-color: #3e5c69;
        }
        #add-item {
            background-color: #666666;
        }
        #add-item:hover {
            background-color: #444444;
        }
        #update-item {
            background-color: #55aa55;
            display: none;
        }
        #update-item:hover {
            background-color: #448844;
        }
        #cancel-edit {
            background-color: #888888;
            display: none;
        }
        #cancel-edit:hover {
            background-color: #666666;
        }
        /* Fixed print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-preview, .print-preview * {
                visibility: visible;
            }
            .print-preview {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                margin: 0;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sun Qwin Enterprises - Billing App</h1>
            <div>
                <span id="current-date"></span>
            </div>
        </div>
        
        <div class="dashboard">
            <div>
                <div class="panel">
                    <div class="tabs">
                        <div class="tab active" data-tab="customer">Customer</div>
                        <div class="tab" data-tab="items">Items</div>
                        <div class="tab" data-tab="settings">Settings</div>
                    </div>
                    
                    <div id="customer-tab" class="tab-content">
                        <h2>Customer Information</h2>
                        <div class="form-group">
                            <label for="customer-name">Customer Name</label>
                            <input type="text" id="customer-name" placeholder="Enter customer name">
                        </div>
                        <div class="form-group">
                            <label for="customer-phone">Phone Number</label>
                            <input type="text" id="customer-phone" placeholder="Enter phone number">
                        </div>
                        <div class="form-group">
                            <label for="customer-email">Email</label>
                            <input type="email" id="customer-email" placeholder="Enter email address">
                        </div>
                        <div class="form-group">
                            <label for="customer-address">Address</label>
                            <input type="text" id="customer-address" placeholder="Enter address">
                        </div>
                        <div class="form-group">
                            <label for="bill-number">Bill Number</label>
                            <input type="text" id="bill-number" placeholder="Enter bill number">
                        </div>
                        <div class="form-group">
                            <label for="payment-method">Payment Method</label>
                            <select id="payment-method">
                                <option value="Cash">Cash</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Debit Card">Debit Card</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="UPI">UPI</option>
                                <option value="Check">Check</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="items-tab" class="tab-content" style="display: none;">
                        <h2 id="item-form-title">Add Item</h2>
                        <div class="form-group">
                            <label for="item-name">Item Name</label>
                            <input type="text" id="item-name" placeholder="Enter item name">
                        </div>
                        <div class="form-group">
                            <label for="item-description">Item Description</label>
                            <textarea id="item-description" placeholder="Enter item description/specifications"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="item-quantity">Quantity</label>
                            <input type="number" id="item-quantity" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="item-price">Price (per unit)</label>
                            <input type="number" id="item-price" min="0" step="0.01" placeholder="Enter price">
                        </div>
                        <div class="form-group">
                            <label for="item-tax">Tax Rate (%)</label>
                            <input type="number" id="item-tax" min="0" max="100" step="0.01" value="0">
                        </div>
                        <div class="form-group">
                            <label for="item-warranty">Warranty (months)</label>
                            <input type="number" id="item-warranty" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="item-serial">Serial Number/Model</label>
                            <input type="text" id="item-serial" placeholder="Enter serial number or model">
                        </div>
                        <button id="add-item">Add Item</button>
                        <button id="update-item">Update Item</button>
                        <button id="cancel-edit">Cancel</button>
                        <input type="hidden" id="edit-item-index" value="-1">
                    </div>
                    
                    <div id="settings-tab" class="tab-content" style="display: none;">
                        <h2>Company Settings</h2>
                        <div class="form-group">
                            <label for="company-name">Company Name</label>
                            <input type="text" id="company-name" value="Sun Qwin Enterprises">
                        </div>
                        <div class="form-group">
                            <label for="company-street">Street Address</label>
                            <input type="text" id="company-street" value="123 Business Street">
                        </div>
                        <div class="form-group">
                            <label for="company-city">City, State, ZIP</label>
                            <input type="text" id="company-city" value="Business District">
                        </div>
                        <div class="form-group">
                            <label for="company-phone">Phone</label>
                            <input type="text" id="company-phone" value="+1 (555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label for="company-email">Email</label>
                            <input type="email" id="company-email" value="contact@sunqwin.com">
                        </div>
                        <div class="form-group">
                            <label for="company-website">Website</label>
                            <input type="text" id="company-website" value="www.sunqwin.com">
                        </div>
                        <div class="form-group">
                            <label for="default-tax">Default Tax Rate (%)</label>
                            <input type="number" id="default-tax" min="0" max="100" step="0.01" value="5">
                        </div>
                        <div class="form-group">
                            <label for="terms-conditions">Terms & Conditions</label>
                            <textarea id="terms-conditions">1. All items have warranty as specified on the invoice.
2. Warranty is void if product is tampered with.
3. Original invoice must be presented for any warranty claims.
4. Returns accepted within 7 days of purchase with original packaging.</textarea>
                        </div>
                        <button id="save-settings">Save Settings</button>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="panel">
                    <h2>Bill Preview</h2>
                    <table id="items-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Price</th>
                                <th>Tax</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="items-body">
                            <!-- Items will be added here dynamically -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="4">Subtotal</td>
                                <td id="subtotal-amount">0.00</td>
                                <td colspan="2"></td>
                            </tr>
                            <tr>
                                <td colspan="4">Tax</td>
                                <td id="tax-amount">0.00</td>
                                <td colspan="2"></td>
                            </tr>
                            <tr class="total-row">
                                <td colspan="4">Grand Total</td>
                                <td id="total-amount">0.00</td>
                                <td colspan="2"></td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div class="actions">
                        <button id="generate-bill">Generate Bill</button>
                        <button id="print-bill">Print Bill</button>
                        <button id="save-pdf">Save as PDF</button>
                        <button id="reset-bill">Reset</button>
                    </div>
                </div>
                
                <div class="panel print-preview" id="print-area">
                    <div class="bill-header">
                        <div>
                            <div class="company-name" id="bill-company-name">Sun Qwin Enterprises</div>
                            <div class="company-info" id="company-address">
                                123 Business Street, Business District<br>
                                Phone: +1 (555) 123-4567<br>
                                Email: contact@sunqwin.com<br>
                                Website: www.sunqwin.com
                            </div>
                        </div>
                        <div>
                            <div>Invoice No: <span id="bill-no"></span></div>
                            <div>Date: <span id="bill-date"></span></div>
                            <div>Payment: <span id="bill-payment"></span></div>
                        </div>
                    </div>
                    
                    <div class="bill-title">INVOICE</div>
                    
                    <div class="customer-info">
                        <div><strong>Customer:</strong> <span id="bill-customer-name"></span></div>
                        <div><strong>Phone:</strong> <span id="bill-customer-phone"></span></div>
                        <div><strong>Email:</strong> <span id="bill-customer-email"></span></div>
                        <div><strong>Address:</strong> <span id="bill-customer-address"></span></div>
                    </div>
                    
                    <table id="bill-items">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Item Description</th>
                                <th>Serial/Model</th>
                                <th>Warranty</th>
                                <th>Qty</th>
                                <th>Unit Price</th>
                                <th>Tax (%)</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="bill-items-body">
                            <!-- Items will be added here dynamically -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="6" style="text-align: right;"><strong>Subtotal:</strong></td>
                                <td colspan="2" id="bill-subtotal">0.00</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="text-align: right;"><strong>Tax Amount:</strong></td>
                                <td colspan="2" id="bill-tax">0.00</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="text-align: right;"><strong>Grand Total:</strong></td>
                                <td colspan="2" id="bill-total">0.00</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div class="warranty-info">
                        <h4>Terms and Conditions:</h4>
                        <p id="bill-terms">
                            1. All items have warranty as specified on the invoice.<br>
                            2. Warranty is void if product is tampered with.<br>
                            3. Original invoice must be presented for any warranty claims.<br>
                            4. Returns accepted within 7 days of purchase with original packaging.
                        </p>
                    </div>
                    
                    <div class="footer">
                        Thank you for your business!
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
// Define the inventory items array globally
let inventoryItems = [];
// Initialize items array
let items = [];
let subtotal = 0;
let taxTotal = 0;
let grandTotal = 0;
let editingItemIndex = -1;

// Function to parse CSV data into inventory items
function parseCSVInventory(csvText) {
    // Split the CSV text into lines
    const lines = csvText.trim().split('\n');
    
    // Extract headers from the first line
    const headers = lines[0].split(',').map(header => header.trim());
    
    // Process each line (skipping the header)
    const items = [];
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        // Skip empty lines
        if (line.trim() === '') continue;
        
        // Split the line by comma, but handle cases where commas are within quotes
        const values = [];
        let currentValue = '';
        let inQuotes = false;
        
        for (let j = 0; j < line.length; j++) {
            const char = line[j];
            
            if (char === '"' && (j === 0 || line[j-1] !== '\\')) {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                values.push(currentValue.trim());
                currentValue = '';
            } else {
                currentValue += char;
            }
        }
        
        // Add the last value
        values.push(currentValue.trim());
        
        // Create an object from the headers and values
        const item = {};
        for (let j = 0; j < headers.length; j++) {
            // Remove quotes if present
            let value = values[j] || '';
            if (value.startsWith('"') && value.endsWith('"')) {
                value = value.slice(1, -1);
            }
            
            // Convert numeric values
            if (headers[j] === 'price' || headers[j] === 'taxRate') {
                item[headers[j]] = parseFloat(value) || 0;
            } else if (headers[j] === 'warranty') {
                item[headers[j]] = parseInt(value) || 0;
            } else {
                item[headers[j]] = value;
            }
        }
        
        items.push(item);
    }
    
    return items;
}

// Function to add a CSV import button and interface
function addCSVImportFeature() {
    // Create the import container
    const importContainer = document.createElement('div');
    importContainer.className = 'csv-import-container';
    
    // Create the input and button elements
    importContainer.innerHTML = `
        <h3>Import Inventory from CSV</h3>
        <p class="csv-format-info">CSV Format: name,description,price,taxRate,warranty</p>
        <div class="csv-input-group">
            <input type="file" id="csv-file-input" accept=".csv" />
            <button id="upload-csv" class="csv-upload-btn">Upload CSV</button>
        </div>
        <div id="csv-preview" class="csv-preview" style="display: none;">
            <h4>Preview of Imported Items (<span id="preview-count">0</span>)</h4>
            <div id="preview-content" class="preview-content"></div>
            <button id="confirm-import" class="confirm-import-btn">Confirm Import</button>
            <button id="cancel-import" class="cancel-import-btn">Cancel</button>
        </div>
    `;
    
    // Add CSS styles
    const style = document.createElement('style');
    style.textContent = `
        .csv-import-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 5px;
            border: 1px solid #cce0ff;
        }
        
        .csv-import-container h3 {
            margin-top: 0;
            color: #0066cc;
        }
        
        .csv-format-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .csv-input-group {
            display: flex;
            margin-bottom: 15px;
        }
        
        .csv-input-group input[type="file"] {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
        }
        
        .csv-upload-btn {
            padding: 8px 15px;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .csv-upload-btn:hover {
            background-color: #0052a3;
        }
        
        .csv-preview {
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: white;
        }
        
        .csv-preview h4 {
            margin-top: 0;
            color: #333;
        }
        
        .preview-content {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .preview-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .preview-item:last-child {
            border-bottom: none;
        }
        
        .confirm-import-btn, .cancel-import-btn {
            padding: 8px 15px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .confirm-import-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .confirm-import-btn:hover {
            background-color: #45a049;
        }
        
        .cancel-import-btn {
            background-color: #f44336;
            color: white;
        }
        
        .cancel-import-btn:hover {
            background-color: #d32f2f;
        }
    `;
    document.head.appendChild(style);
    
    return importContainer;
}

// Function to update the item selection dropdown with current inventory
function updateItemSelectionDropdown() {
    const select = document.getElementById('item-selection');
    if (!select) return;
    
    // Clear current options except the first (default) option
    while (select.options.length > 1) {
        select.remove(1);
    }
    
    // Add inventory items as options
    inventoryItems.forEach((item, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${item.name} - $${item.price.toFixed(2)}`;
        select.appendChild(option);
    });
}

// Display current date
function setCurrentDate() {
    const today = new Date();
    const formattedDate = today.toLocaleDateString('en-US', {
        year: 'numeric', 
        month: 'long', 
        day: 'numeric'
    });
    const dateElement = document.getElementById('current-date');
    if (dateElement) {
        dateElement.textContent = formattedDate;
    }
    return formattedDate;
}

// Setup event listeners for CSV import
function setupCSVImportListeners() {
    const fileInput = document.getElementById('csv-file-input');
    const uploadButton = document.getElementById('upload-csv');
    const previewDiv = document.getElementById('csv-preview');
    const previewContent = document.getElementById('preview-content');
    const previewCount = document.getElementById('preview-count');
    const confirmButton = document.getElementById('confirm-import');
    const cancelButton = document.getElementById('cancel-import');
    
    let parsedItems = [];
    
    uploadButton.addEventListener('click', function() {
        const file = fileInput.files[0];
        if (!file) {
            alert('Please select a CSV file first.');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const csvText = e.target.result;
            try {
                parsedItems = parseCSVInventory(csvText);
                
                // Display preview
                previewContent.innerHTML = '';
                parsedItems.forEach((item, index) => {
                    if (index < 5) { // Show only first 5 items in preview
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'preview-item';
                        itemDiv.innerHTML = `
                            <strong>${item.name}</strong> - $${item.price.toFixed(2)}<br>
                            ${item.description}<br>
                            Tax: ${item.taxRate}%, Warranty: ${item.warranty} months
                        `;
                        previewContent.appendChild(itemDiv);
                    }
                });
                
                if (parsedItems.length > 5) {
                    const moreDiv = document.createElement('div');
                    moreDiv.className = 'preview-item';
                    moreDiv.innerHTML = `<em>...and ${parsedItems.length - 5} more items</em>`;
                    previewContent.appendChild(moreDiv);
                }
                
                previewCount.textContent = parsedItems.length;
                previewDiv.style.display = 'block';
                
            } catch (error) {
                alert('Error parsing the CSV file: ' + error.message);
            }
        };
        reader.readAsText(file);
    });
    
    confirmButton.addEventListener('click', function() {
        if (parsedItems.length > 0) {
            // Add the parsed items to the inventory
            inventoryItems.push(...parsedItems);
            
            // Refresh the item selection dropdown
            updateItemSelectionDropdown();
            
            alert(`Successfully imported ${parsedItems.length} items to inventory.`);
            previewDiv.style.display = 'none';
            fileInput.value = '';
        }
    });
    
    cancelButton.addEventListener('click', function() {
        previewDiv.style.display = 'none';
        fileInput.value = '';
    });
}

// Initialize the app when the document is ready
document.addEventListener('DOMContentLoaded', function() {
    // Set current date
    const formattedDate = setCurrentDate();
    
    // Set up tab switching
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active class from all tabs
            tabs.forEach(t => t.classList.remove('active'));
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected tab content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId + '-tab').style.display = 'block';
        });
    });
    
    // Add the CSV import feature to settings tab
    const settingsTab = document.getElementById('settings-tab');
    if (settingsTab) {
        settingsTab.appendChild(addCSVImportFeature());
        // Set up CSV import listeners after adding the feature to DOM
        setTimeout(setupCSVImportListeners, 0);
    }
    
    // Set the default tax rate in the item form
    const defaultTaxInput = document.getElementById('default-tax');
    if (defaultTaxInput) {
        const defaultTax = defaultTaxInput.value;
        const itemTaxInput = document.getElementById('item-tax');
        if (itemTaxInput) {
            itemTaxInput.value = defaultTax;
        }
        
        // Set up default tax rate event listener
        defaultTaxInput.addEventListener('change', function() {
            const itemTaxInput = document.getElementById('item-tax');
            if (itemTaxInput) {
                itemTaxInput.value = this.value;
            }
        });
    }
    
    // Set up save settings button
    const saveSettingsBtn = document.getElementById('save-settings');
    if (saveSettingsBtn) {
        saveSettingsBtn.addEventListener('click', function() {
            const companyName = document.getElementById('company-name').value;
            const street = document.getElementById('company-street').value;
            const city = document.getElementById('company-city').value;
            const phone = document.getElementById('company-phone').value;
            const email = document.getElementById('company-email').value;
            const website = document.getElementById('company-website').value;
            const terms = document.getElementById('terms-conditions').value;
            
            // Update company info in bill
            const billCompanyName = document.getElementById('bill-company-name');
            if (billCompanyName) billCompanyName.textContent = companyName;
            
            const companyAddress = document.getElementById('company-address');
            if (companyAddress) {
                companyAddress.innerHTML = 
                    `${street}, ${city}<br>
                    Phone: ${phone}<br>
                    Email: ${email}<br>
                    Website: ${website}`;
            }
            
            const billTerms = document.getElementById('bill-terms');
            if (billTerms) billTerms.innerHTML = terms.replace(/\n/g, '<br>');
            
            alert('Settings saved successfully!');
        });
    }
    
    // Add item button
    const addItemBtn = document.getElementById('add-item');
    if (addItemBtn) {
        addItemBtn.addEventListener('click', function() {
            const itemName = document.getElementById('item-name').value;
            const itemDesc = document.getElementById('item-description').value;
            const quantity = parseInt(document.getElementById('item-quantity').value);
            const price = parseFloat(document.getElementById('item-price').value);
            const taxRate = parseFloat(document.getElementById('item-tax').value);
            const warranty = parseInt(document.getElementById('item-warranty').value);
            const serialNum = document.getElementById('item-serial').value;
            
            if (!itemName || isNaN(quantity) || isNaN(price)) {
                alert('Please fill in all required item details (name, quantity, price).');
                return;
            }
            
            const itemTotal = quantity * price;
            const itemTaxAmount = itemTotal * (taxRate / 100);
            const itemTotalWithTax = itemTotal + itemTaxAmount;
            
            // Add to items array
            items.push({
                name: itemName,
                description: itemDesc,
                quantity: quantity,
                price: price,
                taxRate: taxRate,
                taxAmount: itemTaxAmount,
                total: itemTotalWithTax,
                warranty: warranty,
                serialNum: serialNum
            });
            
            // Update the table
            updateItemsTable();
            
            // Clear item inputs
            clearItemForm();
        });
    }
    
    // Update item button (for editing)
    const updateItemBtn = document.getElementById('update-item');
    if (updateItemBtn) {
        updateItemBtn.addEventListener('click', function() {
            const itemName = document.getElementById('item-name').value;
            const itemDesc = document.getElementById('item-description').value;
            const quantity = parseInt(document.getElementById('item-quantity').value);
            const price = parseFloat(document.getElementById('item-price').value);
            const taxRate = parseFloat(document.getElementById('item-tax').value);
            const warranty = parseInt(document.getElementById('item-warranty').value);
            const serialNum = document.getElementById('item-serial').value;
            const editIndexInput = document.getElementById('edit-item-index');
            const editIndex = parseInt(editIndexInput ? editIndexInput.value : -1);
            
            if (!itemName || isNaN(quantity) || isNaN(price)) {
                alert('Please fill in all required item details (name, quantity, price).');
                return;
            }
            
            if (editIndex < 0 || editIndex >= items.length) {
                alert('Invalid item index.');
                return;
            }
            
            const itemTotal = quantity * price;
            const itemTaxAmount = itemTotal * (taxRate / 100);
            const itemTotalWithTax = itemTotal + itemTaxAmount;
            
            // Update the item in the array
            items[editIndex] = {
                name: itemName,
                description: itemDesc,
                quantity: quantity,
                price: price,
                taxRate: taxRate,
                taxAmount: itemTaxAmount,
                total: itemTotalWithTax,
                warranty: warranty,
                serialNum: serialNum
            };
            
            // Update the table
            updateItemsTable();
            
            // Clear form and reset to add mode
            clearItemForm();
            toggleItemFormMode('add');
        });
    }
    
    // Cancel edit button
    const cancelEditBtn = document.getElementById('cancel-edit');
    if (cancelEditBtn) {
        cancelEditBtn.addEventListener('click', function() {
            clearItemForm();
            toggleItemFormMode('add');
        });
    }
    
    // Generate bill button
    const generateBillBtn = document.getElementById('generate-bill');
    if (generateBillBtn) {
        generateBillBtn.addEventListener('click', function() {
            const customerName = document.getElementById('customer-name').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerAddress = document.getElementById('customer-address').value;
            const billNumber = document.getElementById('bill-number').value;
            const paymentMethod = document.getElementById('payment-method').value;
            
            if (!customerName || !billNumber) {
                alert('Please provide customer name and bill number.');
                return;
            }
            
            if (items.length === 0) {
                alert('Please add at least one item to the bill.');
                return;
            }
            
            // Update bill preview with customer details
            const billCustomerName = document.getElementById('bill-customer-name');
            if (billCustomerName) billCustomerName.textContent = customerName;
            
            const billCustomerPhone = document.getElementById('bill-customer-phone');
            if (billCustomerPhone) billCustomerPhone.textContent = customerPhone;
            
            const billCustomerEmail = document.getElementById('bill-customer-email');
            if (billCustomerEmail) billCustomerEmail.textContent = customerEmail;
            
            const billCustomerAddress = document.getElementById('bill-customer-address');
            if (billCustomerAddress) billCustomerAddress.textContent = customerAddress;
            
            const billNo = document.getElementById('bill-no');
            if (billNo) billNo.textContent = billNumber;
            
            const billDate = document.getElementById('bill-date');
            if (billDate) billDate.textContent = formattedDate;
            
            const billPayment = document.getElementById('bill-payment');
            if (billPayment) billPayment.textContent = paymentMethod;
            
            // Update bill items
            const billItemsBody = document.getElementById('bill-items-body');
            if (billItemsBody) {
                billItemsBody.innerHTML = '';
                
                items.forEach((item, index) => {
                    const row = document.createElement('tr');
                    
                    const snoCell = document.createElement('td');
                    snoCell.textContent = index + 1;
                    
                    const descCell = document.createElement('td');
                    descCell.innerHTML = `<strong>${item.name}</strong><br>${item.description}`;
                    
                    const serialCell = document.createElement('td');
                    serialCell.textContent = item.serialNum || 'N/A';
                    
                    const warrantyCell = document.createElement('td');
                    warrantyCell.textContent = item.warranty > 0 ? `${item.warranty} months` : 'None';
                    
                    const qtyCell = document.createElement('td');
                    qtyCell.textContent = item.quantity;
                    
                    const priceCell = document.createElement('td');
                    priceCell.textContent = item.price.toFixed(2);
                    
                    const taxCell = document.createElement('td');
                    taxCell.textContent = item.taxRate + '%';
                    
                    const amountCell = document.createElement('td');
                    amountCell.textContent = item.total.toFixed(2);
                    
                    row.appendChild(snoCell);
                    row.appendChild(descCell);
                    row.appendChild(serialCell);
                    row.appendChild(warrantyCell);
                    row.appendChild(qtyCell);
                    row.appendChild(priceCell);
                    row.appendChild(taxCell);
                    row.appendChild(amountCell);
                    
                    billItemsBody.appendChild(row);
                });
                
                // Update bill totals
                const billSubtotal = document.getElementById('bill-subtotal');
                if (billSubtotal) billSubtotal.textContent = subtotal.toFixed(2);
                
                const billTax = document.getElementById('bill-tax');
                if (billTax) billTax.textContent = taxTotal.toFixed(2);
                
                const billTotal = document.getElementById('bill-total');
                if (billTotal) billTotal.textContent = grandTotal.toFixed(2);
                
                // Show print preview
                const printArea = document.getElementById('print-area');
                if (printArea) printArea.style.display = 'block';
            }
        });
    }
    
    // Print bill button
    const printBillBtn = document.getElementById('print-bill');
    if (printBillBtn) {
        printBillBtn.addEventListener('click', function() {
            window.print();
        });
    }
    
    // Save as PDF button
    const savePdfBtn = document.getElementById('save-pdf');
    if (savePdfBtn) {
        savePdfBtn.addEventListener('click', function() {
            window.print();
        });
    }
    
    // Reset button
    const resetBillBtn = document.getElementById('reset-bill');
    if (resetBillBtn) {
        resetBillBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to reset the bill? All data will be cleared.')) {
                // Clear customer info
                const customerName = document.getElementById('customer-name');
                if (customerName) customerName.value = '';
                
                const customerPhone = document.getElementById('customer-phone');
                if (customerPhone) customerPhone.value = '';
                
                const customerEmail = document.getElementById('customer-email');
                if (customerEmail) customerEmail.value = '';
                
                const customerAddress = document.getElementById('customer-address');
                if (customerAddress) customerAddress.value = '';
                
                const billNumber = document.getElementById('bill-number');
                if (billNumber) billNumber.value = '';
                
                const paymentMethod = document.getElementById('payment-method');
                if (paymentMethod) paymentMethod.selectedIndex = 0;
                
                // Clear items
                items = [];
                updateItemsTable();
                
                // Clear bill preview
                const printArea = document.getElementById('print-area');
                if (printArea) printArea.style.display = 'none';
            }
        });
    }
    
    // Hide the print preview initially
    const printArea = document.getElementById('print-area');
    if (printArea) printArea.style.display = 'none';
});

// Function to toggle item form between add and edit modes
function toggleItemFormMode(mode) {
    const addBtn = document.getElementById('add-item');
    const updateBtn = document.getElementById('update-item');
    const cancelBtn = document.getElementById('cancel-edit');
    const formTitle = document.getElementById('item-form-title');
    
    if (!addBtn || !updateBtn || !cancelBtn || !formTitle) return;
    
    if (mode === 'add') {
        formTitle.textContent = 'Add Item';
        addBtn.style.display = 'inline-block';
        updateBtn.style.display = 'none';
        cancelBtn.style.display = 'none';
        
        const editItemIndex = document.getElementById('edit-item-index');
        if (editItemIndex) editItemIndex.value = '-1';
    } else if (mode === 'edit') {
        formTitle.textContent = 'Edit Item';
        addBtn.style.display = 'none';
        updateBtn.style.display = 'inline-block';
        cancelBtn.style.display = 'inline-block';
    }
}

// Clear item form fields
function clearItemForm() {
    const itemName = document.getElementById('item-name');
    if (itemName) itemName.value = '';
    
    const itemDescription = document.getElementById('item-description');
    if (itemDescription) itemDescription.value = '';
    
    const itemQuantity = document.getElementById('item-quantity');
    if (itemQuantity) itemQuantity.value = '1';
    
    const itemPrice = document.getElementById('item-price');
    if (itemPrice) itemPrice.value = '';
    
    const defaultTax = document.getElementById('default-tax');
    const itemTax = document.getElementById('item-tax');
    if (defaultTax && itemTax) itemTax.value = defaultTax.value;
    
    const itemWarranty = document.getElementById('item-warranty');
    if (itemWarranty) itemWarranty.value = '0';
    
    const itemSerial = document.getElementById('item-serial');
    if (itemSerial) itemSerial.value = '';
}

// Edit item function
function editItem(index) {
    if (index < 0 || index >= items.length) {
        alert('Invalid item index.');
        return;
    }
    
    const item = items[index];
    
    // Populate form with item details
    const itemName = document.getElementById('item-name');
    if (itemName) itemName.value = item.name;
    
    const itemDescription = document.getElementById('item-description');
    if (itemDescription) itemDescription.value = item.description;
    
    const itemQuantity = document.getElementById('item-quantity');
    if (itemQuantity) itemQuantity.value = item.quantity;
    
    const itemPrice = document.getElementById('item-price');
    if (itemPrice) itemPrice.value = item.price;
    
    const itemTax = document.getElementById('item-tax');
    if (itemTax) itemTax.value = item.taxRate;
    
    const itemWarranty = document.getElementById('item-warranty');
    if (itemWarranty) itemWarranty.value = item.warranty;
    
    const itemSerial = document.getElementById('item-serial');
    if (itemSerial) itemSerial.value = item.serialNum;
    
    const editItemIndex = document.getElementById('edit-item-index');
    if (editItemIndex) editItemIndex.value = index;
    
    // Switch to edit mode
    toggleItemFormMode('edit');
    
    // Switch to items tab
    const itemsTab = document.querySelector('.tab[data-tab="items"]');
    if (itemsTab) itemsTab.click();
}

// Function to update the items table
function updateItemsTable() {
    const tableBody = document.getElementById('items-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    subtotal = 0;
    taxTotal = 0;
    grandTotal = 0;
    
    items.forEach((item, index) => {
        const row = document.createElement('tr');
        
        const nameCell = document.createElement('td');
        nameCell.textContent = item.name;
        
        const descCell = document.createElement('td');
        descCell.textContent = item.description.length > 15 ? 
            item.description.substring(0, 15) + '...' : 
            item.description;
        
        const quantityCell = document.createElement('td');
        quantityCell.textContent = item.quantity;
        
        const priceCell = document.createElement('td');
        priceCell.textContent = item.price.toFixed(2);
        
        const taxCell = document.createElement('td');
        taxCell.textContent = item.taxRate + '%';
        
        const totalCell = document.createElement('td');
        totalCell.textContent = item.total.toFixed(2);
        
        const actionsCell = document.createElement('td');
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'item-actions';
        
        // Edit button
        const editButton = document.createElement('button');
        editButton.className = 'edit-btn';
        editButton.textContent = 'Edit';
        editButton.addEventListener('click', function() {
            editItem(index);
        });
        
        // Remove button
        const removeButton = document.createElement('button');
        removeButton.className = 'remove-btn';
        removeButton.textContent = 'Remove';
        removeButton.addEventListener('click', function() {
            items.splice(index, 1);
            updateItemsTable();
        });
        
        actionsDiv.appendChild(editButton);
        actionsDiv.appendChild(removeButton);
        actionsCell.appendChild(actionsDiv);
        
        row.appendChild(nameCell);
        row.appendChild(descCell);
        row.appendChild(quantityCell);
        row.appendChild(priceCell);
        row.appendChild(taxCell);
        row.appendChild(totalCell);
        row.appendChild(actionsCell);
        
        tableBody.appendChild(row);
        
        // Update totals
        const itemSubtotal = item.quantity * item.price;
        subtotal += itemSubtotal;
        taxTotal += item.taxAmount;
        grandTotal += item.total;
    });
    
    // Update summary values
    const subtotalAmount = document.getElementById('subtotal-amount');
    if (subtotalAmount) subtotalAmount.textContent = subtotal.toFixed(2);
    
    const taxAmount = document.getElementById('tax-amount');
    if (taxAmount) taxAmount.textContent = taxTotal.toFixed(2);
    
    const totalAmount = document.getElementById('total-amount');
    if (totalAmount) totalAmount.textContent = grandTotal.toFixed(2);
}
</script>
</body>
</html>
