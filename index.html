<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing System with Inventory</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background-color: #0072CE;
            color: white;
            padding: 15px 0;
            margin-bottom: 30px;
        }
        
        header h1 {
            margin: 0;
            padding: 0 20px;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            margin-bottom: -1px;
            font-weight: bold;
        }
        
        /* Tab Content */
        .tab-content {
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            display: none;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        button {
            padding: 8px 15px;
            background-color: #0072CE;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #005bb5;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        table th, table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        
        .item-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn {
            background-color: #4caf50;
        }
        
        .remove-btn {
            background-color: #f44336;
        }
        
        /* Summary Section */
        .summary {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
        }
        
        .summary-table {
            width: 300px;
            margin-bottom: 20px;
        }
        
        .summary-table td:first-child {
            font-weight: 600;
        }
        
        .summary-table td:last-child {
            text-align: right;
        }
        
        /* Print Area Styles */
        #print-area {
            background-color: white;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #ddd;
        }
        
        .bill-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .company-details, .bill-details {
            flex: 1;
        }
        
        .company-details h2 {
            color: #0072CE;
            margin-top: 0;
        }
        
        .bill-details {
            text-align: right;
        }
        
        .bill-details strong {
            margin-right: 10px;
        }
        
        .customer-details {
            margin-bottom: 30px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        
        .bill-footer {
            margin-top: 30px;
        }
        
        .bill-footer h4 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        
        .action-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        /* CSV Import Styles */
        .csv-import-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 5px;
            border: 1px solid #cce0ff;
        }
        
        .csv-import-container h3 {
            margin-top: 0;
            color: #0066cc;
        }
        
        .csv-format-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .csv-input-group {
            display: flex;
            margin-bottom: 15px;
        }
        
        .csv-input-group input[type="file"] {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
        }
        
        .csv-upload-btn {
            padding: 8px 15px;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .csv-upload-btn:hover {
            background-color: #0052a3;
        }
        
        .csv-preview {
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: white;
        }
        
        .csv-preview h4 {
            margin-top: 0;
            color: #333;
        }
        
        .preview-content {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .preview-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .preview-item:last-child {
            border-bottom: none;
        }
        
        .confirm-import-btn, .cancel-import-btn {
            padding: 8px 15px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .confirm-import-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .confirm-import-btn:hover {
            background-color: #45a049;
        }
        
        .cancel-import-btn {
            background-color: #f44336;
            color: white;
        }
        
        .cancel-import-btn:hover {
            background-color: #d32f2f;
        }
        
        /* For print media */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #print-area, #print-area * {
                visibility: visible;
            }
            
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
            }
            
            .action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Billing System with Inventory</h1>
        </div>
    </header>
    
    <div class="container">
        <!-- Tab Navigation -->
        <div class="tabs">
            <div class="tab active" data-tab="customer">Customer Details</div>
            <div class="tab" data-tab="items">Add Items</div>
            <div class="tab" data-tab="inventory">Inventory</div>
            <div class="tab" data-tab="settings">Settings</div>
        </div>
        
        <!-- Customer Details Tab -->
        <div id="customer-tab" class="tab-content" style="display: block;">
            <h2>Customer Information</h2>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="customer-name">Customer Name *</label>
                        <input type="text" id="customer-name" placeholder="Enter customer name" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-phone">Phone Number</label>
                        <input type="tel" id="customer-phone" placeholder="Enter phone number">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="customer-email">Email Address</label>
                        <input type="email" id="customer-email" placeholder="Enter email address">
                    </div>
                    <div class="form-group">
                        <label for="customer-address">Address</label>
                        <textarea id="customer-address" placeholder="Enter customer address"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="bill-number">Bill Number *</label>
                        <input type="text" id="bill-number" placeholder="Enter bill number" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="payment-method">Payment Method</label>
                        <select id="payment-method">
                            <option value="Cash">Cash</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Check">Check</option>
                            <option value="PayPal">PayPal</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <button id="next-to-items" class="next-btn">Next: Add Items</button>
            </div>
        </div>
        
        <!-- Items Tab -->
        <div id="items-tab" class="tab-content">
            <h2 id="item-form-title">Add Item</h2>
            
            <div class="form-group">
                <label for="item-selection">Select from Inventory:</label>
                <select id="item-selection" class="form-control">
                    <option value="-1">-- Select Item --</option>
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="item-name">Item Name *</label>
                        <input type="text" id="item-name" placeholder="Enter item name" required>
                    </div>
                    <div class="form-group">
                        <label for="item-description">Description</label>
                        <textarea id="item-description" placeholder="Enter item description"></textarea>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="item-quantity">Quantity *</label>
                        <input type="number" id="item-quantity" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="item-price">Price *</label>
                        <input type="number" id="item-price" min="0" step="0.01" placeholder="0.00" required>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="item-tax">Tax Rate (%)</label>
                        <input type="number" id="item-tax" min="0" step="0.1" value="7.5">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="item-warranty">Warranty (months)</label>
                        <input type="number" id="item-warranty" min="0" value="0">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="item-serial">Serial Number</label>
                <input type="text" id="item-serial" placeholder="Enter serial number">
            </div>
            
            <input type="hidden" id="edit-item-index" value="-1">
            
            <div class="form-group">
                <button id="add-item">Add Item</button>
                <button id="update-item" style="display: none;">Update Item</button>
                <button id="cancel-edit" style="display: none;">Cancel</button>
            </div>
            
            <div class="items-list">
                <h3>Added Items</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Tax</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="items-body">
                        <!-- Items will be added here dynamically -->
                    </tbody>
                </table>
                
                <div class="summary">
                    <table class="summary-table">
                        <tr>
                            <td>Subtotal:</td>
                            <td id="subtotal-amount">0.00</td>
                        </tr>
                        <tr>
                            <td>Tax:</td>
                            <td id="tax-amount">0.00</td>
                        </tr>
                        <tr>
                            <td>Total:</td>
                            <td id="total-amount">0.00</td>
                        </tr>
                    </table>
                </div>
                
                <div class="form-group">
                    <button id="generate-bill">Generate Bill</button>
                    <button id="reset-bill">Reset Bill</button>
                </div>
            </div>
        </div>
        
        <!-- Inventory Tab -->
        <div id="inventory-tab" class="tab-content">
            <h2>Inventory Management</h2>
            
            <div class="inventory-list">
                <h3>Current Inventory</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Price</th>
                            <th>Tax Rate</th>
                            <th>Warranty</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-body">
                        <!-- Inventory items will be added here dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <h2>Company Settings</h2>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="company-name">Company Name</label>
                        <input type="text" id="company-name" placeholder="Enter company name" value="Tech Solutions Inc.">
                    </div>
                    <div class="form-group">
                        <label for="company-street">Street Address</label>
                        <input type="text" id="company-street" placeholder="Enter street address" value="123 Tech Street">
                    </div>
                    <div class="form-group">
                        <label for="company-city">City, State, ZIP</label>
                        <input type="text" id="company-city" placeholder="Enter city, state, zip" value="Silicon Valley, CA 94043">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="company-phone">Phone Number</label>
                        <input type="tel" id="company-phone" placeholder="Enter phone number" value="(555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label for="company-email">Email Address</label>
                        <input type="email" id="company-email" placeholder="Enter email address" value="info@techsolutions.com">
                    </div>
                    <div class="form-group">
                        <label for="company-website">Website</label>
                        <input type="url" id="company-website" placeholder="Enter website URL" value="www.techsolutions.com">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="default-tax">Default Tax Rate (%)</label>
                <input type="number" id="default-tax" min="0" step="0.1" value="7.5">
            </div>
            
            <div class="form-group">
                <label for="terms-conditions">Terms & Conditions</label>
                <textarea id="terms-conditions">1. Payment is due within 30 days.
2. Warranty is only valid with the original receipt.
3. Returns accepted within 14 days of purchase.
4. All prices are subject to change without notice.</textarea>
            </div>
            
            <div class="form-group">
                <button id="save-settings">Save Settings</button>
            </div>
            
            <!-- CSV Import will be added here dynamically -->
        </div>
        
        <!-- Print Area -->
        <div id="print-area" style="display: none;">
            <div class="bill-header">
                <div class="company-details">
                    <h2 id="bill-company-name">Tech Solutions Inc.</h2>
                    <p id="company-address">
                        123 Tech Street, Silicon Valley, CA 94043<br>
                        Phone: (555) 123-4567<br>
                        Email: info@techsolutions.com<br>
                        Website: www.techsolutions.com
                    </p>
                </div>
                <div class="bill-details">
                    <h2>INVOICE</h2>
                    <p><strong>Invoice #:</strong> <span id="bill-no"></span></p>
                    <p><strong>Date:</strong> <span id="bill-date" id="current-date"></span></p>
                    <p><strong>Payment Method:</strong> <span id="bill-payment"></span></p>
                </div>
            </div>
            
            <div class="customer-details">
                <h3>Bill To:</h3>
                <p><strong>Name:</strong> <span id="bill-customer-name"></span></p>
                <p><strong>Phone:</strong> <span id="bill-customer-phone"></span></p>
                <p><strong>Email:</strong> <span id="bill-customer-email"></span></p>
                <p><strong>Address:</strong> <span id="bill-customer-address"></span></p>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Item Description</th>
                        <th>Serial #</th>
                        <th>Warranty</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Tax</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="bill-items-body">
                    <!-- Bill items will be added here dynamically -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="6"></td>
                        <td><strong>Subtotal:</strong></td>
                        <td id="bill-subtotal">0.00</td>
                    </tr>
                    <tr>
                        <td colspan="6"></td>
                        <td><strong>Tax:</strong></td>
                        <td id="bill-tax">0.00</td>
                    </tr>
                    <tr>
                        <td colspan="6"></td>
                        <td><strong>Total:</strong></td>
                        <td id="bill-total">0.00</td>
                    </tr>
                </tfoot>
            </table>
            
            <div class="bill-footer">
                <h4>Terms & Conditions</h4>
                <p id="bill-terms">
                    1. Payment is due within 30 days.<br>
                    2. Warranty is only valid with the original receipt.<br>
                    3. Returns accepted within 14 days of purchase.<br>
                    4. All prices are subject to change without notice.
                </p>
            </div>
            
            <div class="action-buttons">
                <button id="print-bill">Print Bill</button>
                <button id="save-pdf">Save as PDF</button>
            </div>
        </div>
    </div>
    
    
    <script>
        // Define the inventory items array globally
        let inventoryItems = [];
        // Initialize items array
        let items = [];
        let subtotal = 0;
        let taxTotal = 0;
        let grandTotal = 0;
        let editingItemIndex = -1;

        // Function to parse CSV data into inventory items
        function parseCSVInventory(csvText) {
            // Split the CSV text into lines
            const lines = csvText.trim().split('\n');
            
            // Extract headers from the first line
            const headers = lines[0].split(',').map(header => header.trim());
            
            // Process each line (skipping the header)
            const items = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                // Skip empty lines
                if (line.trim() === '') continue;
                
                // Split the line by comma, but handle cases where commas are within quotes
                const values = [];
                let currentValue = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"' && (j === 0 || line[j-1] !== '\\')) {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(currentValue.trim());
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                
                // Add the last value
                values.push(currentValue.trim());
                
                // Create an object from the headers and values
                const item = {};
                for (let j = 0; j < headers.length; j++) {
                    // Remove quotes if present
                    let value = values[j] || '';
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }
                    
                    // Convert numeric values
                    if (headers[j] === 'price' || headers[j] === 'taxRate') {
                        item[headers[j]] = parseFloat(value) || 0;
                    } else if (headers[j] === 'warranty') {
                        item[headers[j]] = parseInt(value) || 0;
                    } else {
                        item[headers[j]] = value;
                    }
                }
                
                items.push(item);
            }
            
            return items;
        }

        // Add function to load CSV from a GitHub URL
        async function loadInventoryFromGitHub() {
            const githubCsvUrl = 'https://raw.githubusercontent.com/YourUsername/YourRepository/main/inventory.csv';
            
            try {
                const response = await fetch(githubCsvUrl);
                if (!response.ok) {
                    throw new Error(`Failed to fetch CSV: ${response.status}`);
                }
                
                const csvContent = await response.text();
                const items = parseCSVInventory(csvContent);
                
                // Add the parsed items to the inventory
                inventoryItems = items;
                
                // Update the UI
                updateInventoryTable();
                updateItemSelectionDropdown();
                
                console.log(`Successfully loaded ${items.length} inventory items from GitHub.`);
            } catch (error) {
                console.error('Error loading inventory from GitHub:', error);
                // You could show a UI notification here if desired
            }
        }

        // Function to add a CSV import button and interface
        function addCSVImportFeature() {
            // Create the import container
            const importContainer = document.createElement('div');
            importContainer.className = 'csv-import-container';
            
            // Create the input and button elements
            importContainer.innerHTML = `
                <h3>Import Inventory from CSV</h3>
                <p class="csv-format-info">CSV Format: name,description,price,taxRate,warranty</p>
                <div class="csv-input-group">
                    <input type="file" id="csv-file-input" accept=".csv" />
                    <button id="upload-csv" class="csv-upload-btn">Upload CSV</button>
                </div>
                <div id="csv-preview" class="csv-preview" style="display: none;">
                    <h4>Preview of Imported Items (<span id="preview-count">0</span>)</h4>
                    <div id="preview-content" class="preview-content"></div>
                    <button id="confirm-import" class="confirm-import-btn">Confirm Import</button>
                    <button id="cancel-import" class="cancel-import-btn">Cancel</button>
                </div>
            `;
            
            return importContainer;
        }

        // Function to update the item selection dropdown with current inventory
        function updateItemSelectionDropdown() {
            const select = document.getElementById('item-selection');
            if (!select) return;
            
            // Clear current options except the first (default) option
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Add inventory items as options
            inventoryItems.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${item.name} - $${item.price.toFixed(2)}`;
                select.appendChild(option);
            });
        }

        // Function to update the inventory table
        function updateInventoryTable() {
            const tableBody = document.getElementById('inventory-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            inventoryItems.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                
                const descCell = document.createElement('td');
                descCell.textContent = item.description.length > 30 ? 
                    item.description.substring(0, 30) + '...' : 
                    item.description;
                
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + item.price.toFixed(2);
                
                const taxCell = document.createElement('td');
                taxCell.textContent = item.taxRate + '%';
                
                const warrantyCell = document.createElement('td');
                warrantyCell.textContent = item.warranty > 0 ? 
                    item.warranty + ' months' : 'None';
                
                const actionsCell = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                // Add to bill button
                const addButton = document.createElement('button');
                addButton.className = 'edit-btn';
                addButton.textContent = 'Add to Bill';
                addButton.addEventListener('click', function() {
                    // Populate the item form with this inventory item
                    const itemName = document.getElementById('item-name');
                    if (itemName) itemName.value = item.name;
                    
                    const itemDescription = document.getElementById('item-description');
                    if (itemDescription) itemDescription.value = item.description;
                    
                    const itemPrice = document.getElementById('item-price');
                    if (itemPrice) itemPrice.value = item.price;
                    
                    const itemTax = document.getElementById('item-tax');
                    if (itemTax) itemTax.value = item.taxRate;
                    
                    const itemWarranty = document.getElementById('item-warranty');
                    if (itemWarranty) itemWarranty.value = item.warranty;
                    
                    // Switch to items tab
                    const itemsTab = document.querySelector('.tab[data-tab="items"]');
                    if (itemsTab) itemsTab.click();
                });
                
                actionsDiv.appendChild(addButton);
                actionsCell.appendChild(actionsDiv);
                
                row.appendChild(nameCell);
                row.appendChild(descCell);
                row.appendChild(priceCell);
                row.appendChild(taxCell);
                row.appendChild(warrantyCell);
                row.appendChild(actionsCell);
                
                tableBody.appendChild(row);
            });
        }

        // Display current date
        function setCurrentDate() {
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-US', {
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            });
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = formattedDate;
            }
            return formattedDate;
        }

        // Setup event listeners for CSV import
        function setupCSVImportListeners() {
            const fileInput = document.getElementById('csv-file-input');
            const uploadButton = document.getElementById('upload-csv');
            const previewDiv = document.getElementById('csv-preview');
            const previewContent = document.getElementById('preview-content');
            const previewCount = document.getElementById('preview-count');
            const confirmButton = document.getElementById('confirm-import');
            const cancelButton = document.getElementById('cancel-import');
            
            let parsedItems = [];
            
            uploadButton.addEventListener('click', function() {
                const file = fileInput.files[0];
                if (!file) {
                    alert('Please select a CSV file first.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvContent = e.target.result;
                    parsedItems = parseCSVInventory(csvContent);
                    
                    // Show preview
                    previewDiv.style.display = 'block';
                    previewContent.innerHTML = '';
                    previewCount.textContent = parsedItems.length;
                    
                    // Display first 5 items (or fewer if less exist)
                    const previewLimit = Math.min(parsedItems.length, 5);
                    for (let i = 0; i < previewLimit; i++) {
                        const item = parsedItems[i];
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'preview-item';
                        itemDiv.textContent = `${item.name} - $${item.price.toFixed(2)} (${item.taxRate}% Tax, ${item.warranty} months warranty)`;
                        previewContent.appendChild(itemDiv);
                    }
                    
                    if (parsedItems.length > 5) {
                        const moreDiv = document.createElement('div');
                        moreDiv.className = 'preview-item';
                        moreDiv.textContent = `... and ${parsedItems.length - 5} more items`;
                        previewContent.appendChild(moreDiv);
                    }
                };

                reader.readAsText(file);
            });

            confirmButton.addEventListener('click', function() {
                // Add the parsed items to the inventory
                inventoryItems = inventoryItems.concat(parsedItems);
                
                // Update the UI
                updateInventoryTable();
                updateItemSelectionDropdown();
                
                // Reset and hide the preview
                previewDiv.style.display = 'none';
                fileInput.value = '';
                
                alert(`Successfully imported ${parsedItems.length} inventory items.`);
                parsedItems = [];
            });

            cancelButton.addEventListener('click', function() {
                // Reset and hide the preview
                previewDiv.style.display = 'none';
                fileInput.value = '';
                parsedItems = [];
            });
        }

        // Calculate total for an item
        function calculateItemTotal(price, quantity, taxRate) {
            const itemSubtotal = price * quantity;
            const itemTax = itemSubtotal * (taxRate / 100);
            return {
                subtotal: itemSubtotal,
                tax: itemTax,
                total: itemSubtotal + itemTax
            };
        }

        // Update bill summary
        function updateSummary() {
            subtotal = 0;
            taxTotal = 0;
            grandTotal = 0;
            
            items.forEach(item => {
                subtotal += item.subtotal;
                taxTotal += item.tax;
            });
            
            grandTotal = subtotal + taxTotal;
            
            document.getElementById('subtotal-amount').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('tax-amount').textContent = '$' + taxTotal.toFixed(2);
            document.getElementById('total-amount').textContent = '$' + grandTotal.toFixed(2);
        }

        // Add or update item in the bill
        function addOrUpdateItem() {
            const nameInput = document.getElementById('item-name');
            const descriptionInput = document.getElementById('item-description');
            const quantityInput = document.getElementById('item-quantity');
            const priceInput = document.getElementById('item-price');
            const taxInput = document.getElementById('item-tax');
            const warrantyInput = document.getElementById('item-warranty');
            const serialInput = document.getElementById('item-serial');
            
            // Validate required fields
            if (!nameInput.value || !quantityInput.value || !priceInput.value) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const item = {
                name: nameInput.value,
                description: descriptionInput.value,
                quantity: parseInt(quantityInput.value),
                price: parseFloat(priceInput.value),
                taxRate: parseFloat(taxInput.value),
                warranty: parseInt(warrantyInput.value),
                serial: serialInput.value
            };
            
            // Calculate totals
            const totals = calculateItemTotal(item.price, item.quantity, item.taxRate);
            item.subtotal = totals.subtotal;
            item.tax = totals.tax;
            item.total = totals.total;
            
            if (editingItemIndex === -1) {
                // Add new item
                items.push(item);
            } else {
                // Update existing item
                items[editingItemIndex] = item;
                editingItemIndex = -1;
                
                // Reset UI buttons
                document.getElementById('add-item').style.display = 'inline-block';
                document.getElementById('update-item').style.display = 'none';
                document.getElementById('cancel-edit').style.display = 'none';
                document.getElementById('item-form-title').textContent = 'Add Item';
            }
            
            // Update the table and summary
            updateItemsTable();
            updateSummary();
            
            // Reset form
            document.getElementById('item-name').value = '';
            document.getElementById('item-description').value = '';
            document.getElementById('item-quantity').value = '1';
            document.getElementById('item-price').value = '';
            document.getElementById('item-tax').value = document.getElementById('default-tax').value;
            document.getElementById('item-warranty').value = '0';
            document.getElementById('item-serial').value = '';
            document.getElementById('edit-item-index').value = '-1';
        }

        // Update items table
        function updateItemsTable() {
            const tableBody = document.getElementById('items-body');
            tableBody.innerHTML = '';
            
            items.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                
                const descCell = document.createElement('td');
                descCell.textContent = item.description.length > 30 ? 
                    item.description.substring(0, 30) + '...' : 
                    item.description;
                
                const quantityCell = document.createElement('td');
                quantityCell.textContent = item.quantity;
                
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + item.price.toFixed(2);
                
                const taxCell = document.createElement('td');
                taxCell.textContent = item.taxRate + '%';
                
                const totalCell = document.createElement('td');
                totalCell.textContent = '$' + item.total.toFixed(2);
                
                const actionsCell = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'item-actions';
                
                const editButton = document.createElement('button');
                editButton.className = 'edit-btn';
                editButton.textContent = 'Edit';
                editButton.addEventListener('click', function() {
                    editItem(index);
                });
                
                const removeButton = document.createElement('button');
                removeButton.className = 'remove-btn';
                removeButton.textContent = 'Remove';
                removeButton.addEventListener('click', function() {
                    removeItem(index);
                });
                
                actionsDiv.appendChild(editButton);
                actionsDiv.appendChild(removeButton);
                actionsCell.appendChild(actionsDiv);
                
                row.appendChild(nameCell);
                row.appendChild(descCell);
                row.appendChild(quantityCell);
                row.appendChild(priceCell);
                row.appendChild(taxCell);
                row.appendChild(totalCell);
                row.appendChild(actionsCell);
                
                tableBody.appendChild(row);
            });
        }

        // Edit item
        function editItem(index) {
            const item = items[index];
            
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-description').value = item.description;
            document.getElementById('item-quantity').value = item.quantity;
            document.getElementById('item-price').value = item.price;
            document.getElementById('item-tax').value = item.taxRate;
            document.getElementById('item-warranty').value = item.warranty;
            document.getElementById('item-serial').value = item.serial;
            document.getElementById('edit-item-index').value = index;
            
            // Update UI buttons
            document.getElementById('add-item').style.display = 'none';
            document.getElementById('update-item').style.display = 'inline-block';
            document.getElementById('cancel-edit').style.display = 'inline-block';
            document.getElementById('item-form-title').textContent = 'Edit Item';
            
            editingItemIndex = index;
        }

        // Remove item
        function removeItem(index) {
            if (confirm('Are you sure you want to remove this item?')) {
                items.splice(index, 1);
                updateItemsTable();
                updateSummary();
            }
        }

        // Generate bill
        function generateBill() {
            // Validate inputs
            const customerName = document.getElementById('customer-name').value;
            const billNumber = document.getElementById('bill-number').value;
            
            if (!customerName || !billNumber) {
                alert('Please enter customer name and bill number.');
                return;
            }
            
            if (items.length === 0) {
                alert('Please add at least one item to the bill.');
                return;
            }
            
            // Set bill details
            document.getElementById('bill-no').textContent = billNumber;
            document.getElementById('bill-date').textContent = setCurrentDate();
            document.getElementById('bill-payment').textContent = document.getElementById('payment-method').value;
            
            // Set customer details
            document.getElementById('bill-customer-name').textContent = customerName;
            document.getElementById('bill-customer-phone').textContent = document.getElementById('customer-phone').value || 'N/A';
            document.getElementById('bill-customer-email').textContent = document.getElementById('customer-email').value || 'N/A';
            document.getElementById('bill-customer-address').textContent = document.getElementById('customer-address').value || 'N/A';
            
            // Set company details
            document.getElementById('bill-company-name').textContent = document.getElementById('company-name').value;
            const companyAddress = `${document.getElementById('company-street').value}, ${document.getElementById('company-city').value}<br>
                Phone: ${document.getElementById('company-phone').value}<br>
                Email: ${document.getElementById('company-email').value}<br>
                Website: ${document.getElementById('company-website').value}`;
            document.getElementById('company-address').innerHTML = companyAddress;
            
            // Set terms and conditions
            document.getElementById('bill-terms').innerHTML = document.getElementById('terms-conditions').value.replace(/\n/g, '<br>');
            
            // Populate items table
            const billItemsBody = document.getElementById('bill-items-body');
            billItemsBody.innerHTML = '';
            
            items.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const noCell = document.createElement('td');
                noCell.textContent = index + 1;
                
                const descCell = document.createElement('td');
                descCell.innerHTML = `<strong>${item.name}</strong><br>${item.description}`;
                
                const serialCell = document.createElement('td');
                serialCell.textContent = item.serial || 'N/A';
                
                const warrantyCell = document.createElement('td');
                warrantyCell.textContent = item.warranty > 0 ? `${item.warranty} months` : 'None';
                
                const qtyCell = document.createElement('td');
                qtyCell.textContent = item.quantity;
                
                const priceCell = document.createElement('td');
                priceCell.textContent = '$' + item.price.toFixed(2);
                
                const taxCell = document.createElement('td');
                taxCell.textContent = item.taxRate + '%';
                
                const amountCell = document.createElement('td');
                amountCell.textContent = '$' + item.total.toFixed(2);
                
                row.appendChild(noCell);
                row.appendChild(descCell);
                row.appendChild(serialCell);
                row.appendChild(warrantyCell);
                row.appendChild(qtyCell);
                row.appendChild(priceCell);
                row.appendChild(taxCell);
                row.appendChild(amountCell);
                
                billItemsBody.appendChild(row);
            });
            
            // Set summary amounts
            document.getElementById('bill-subtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('bill-tax').textContent = '$' + taxTotal.toFixed(2);
            document.getElementById('bill-total').textContent = '$' + grandTotal.toFixed(2);
            
            // Show print area
            document.getElementById('print-area').style.display = 'block';
        }

        // Reset bill
        function resetBill() {
            if (confirm('Are you sure you want to reset the bill? All items will be removed.')) {
                items = [];
                subtotal = 0;
                taxTotal = 0;
                grandTotal = 0;
                
                updateItemsTable();
                updateSummary();
                
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-email').value = '';
                document.getElementById('customer-address').value = '';
                document.getElementById('bill-number').value = '';
                
                document.getElementById('print-area').style.display = 'none';
            }
        }

        // Initialize the app when DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Add CSV import feature to settings tab
            const settingsTab = document.getElementById('settings-tab');
            if (settingsTab) {
                const csvImport = addCSVImportFeature();
                settingsTab.appendChild(csvImport);
                setupCSVImportListeners();
            }
            
            // Set up tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Remove active class from all tabs
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Show selected tab content and mark tab as active
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-tab').style.display = 'block';
                    this.classList.add('active');
                });
            });
            
            // Set default tax rate on item form
            document.getElementById('item-tax').value = document.getElementById('default-tax').value;
            
            // Set up navigation buttons
            document.getElementById('next-to-items').addEventListener('click', function() {
                document.querySelector('.tab[data-tab="items"]').click();
            });
            
            // Set up item form submit
            document.getElementById('add-item').addEventListener('click', addOrUpdateItem);
            document.getElementById('update-item').addEventListener('click', addOrUpdateItem);
            
            // Set up cancel edit button
            document.getElementById('cancel-edit').addEventListener('click', function() {
                // Reset form
                document.getElementById('item-name').value = '';
                document.getElementById('item-description').value = '';
                document.getElementById('item-quantity').value = '1';
                document.getElementById('item-price').value = '';
                document.getElementById('item-tax').value = document.getElementById('default-tax').value;
                document.getElementById('item-warranty').value = '0';
                document.getElementById('item-serial').value = '';
                document.getElementById('edit-item-index').value = '-1';
                
                // Reset UI buttons
                document.getElementById('add-item').style.display = 'inline-block';
                document.getElementById('update-item').style.display = 'none';
                document.getElementById('cancel-edit').style.display = 'none';
                document.getElementById('item-form-title').textContent = 'Add Item';
                
                editingItemIndex = -1;
            });
            
            // Set up bill generation and reset
            document.getElementById('generate-bill').addEventListener('click', generateBill);
            document.getElementById('reset-bill').addEventListener('click', resetBill);
            
            // Set up print functionality
            document.getElementById('print-bill').addEventListener('click', function() {
                window.print();
            });
            
            // Save settings
            document.getElementById('save-settings').addEventListener('click', function() {
                alert('Settings saved successfully!');
            });
            
            // Setup inventory item selection dropdown
            document.getElementById('item-selection').addEventListener('change', function() {
                const selectedIndex = parseInt(this.value);
                if (selectedIndex >= 0) {
                    const item = inventoryItems[selectedIndex];
                    document.getElementById('item-name').value = item.name;
                    document.getElementById('item-description').value = item.description;
                    document.getElementById('item-price').value = item.price;
                    document.getElementById('item-tax').value = item.taxRate;
                    document.getElementById('item-warranty').value = item.warranty;
                }
            });
            
            // Initialize current date
            setCurrentDate();

            // Add some sample inventory items (fallback)
            inventoryItems = [
                {
                    name: 'Laptop Computer',
                    description: '15-inch laptop with 16GB RAM and 512GB SSD',
                    price: 1299.99,
                    taxRate: 7.5,
                    warranty: 12
                },
                {
                    name: 'Office Chair',
                    description: 'Ergonomic office chair with adjustable height',
                    price: 249.99,
                    taxRate: 7.5,
                    warranty: 24
                },
                {
                    name: 'Wireless Mouse',
                    description: 'Bluetooth wireless mouse with rechargeable battery',
                    price: 39.99,
                    taxRate: 7.5,
                    warranty: 6
                }
            ];
            
            // Try to load inventory from GitHub (will override sample items if successful)
            loadInventoryFromGitHub();
            
            // Update UI with inventory items
            updateInventoryTable();
            updateItemSelectionDropdown();
        });
</script>
</body>
</html>
