<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Billing Dashboard</title>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    /* Simple shadcn-like components */
    .card {
      background: white;
      border-radius: 0.5rem;
      border: 1px solid #e2e8f0;
      overflow: hidden;
    }

    .card-header {
      padding: 1.5rem 1.5rem 0 1.5rem;
    }

    .card-content {
      padding: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .card-description {
      color: #64748b;
      font-size: 0.875rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      line-height: 1;
      padding: 0.25rem 0.5rem;
    }

    .badge-default {
      background-color: #3b82f6;
      color: white;
    }

    .badge-secondary {
      background-color: #6b7280;
      color: white;
    }

    .badge-destructive {
      background-color: #ef4444;
      color: white;
    }

    .btn {
      align-items: center;
      border-radius: 0.375rem;
      display: inline-flex;
      font-size: 0.875rem;
      font-weight: 500;
      justify-content: center;
      line-height: 1;
      padding: 0.5rem 1rem;
      transition-duration: 150ms;
      transition-property: background-color, border-color, color;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer; /* Ensure buttons look clickable */
    }
    .btn:disabled {
        cursor: not-allowed;
        opacity: 0.7;
    }

    .btn-primary {
      background-color: #3b82f6;
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background-color: #2563eb;
    }

    .btn-destructive {
      background-color: #ef4444;
      color: white;
    }

    .btn-destructive:hover:not(:disabled) {
      background-color: #dc2626;
    }

    .btn-sm {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      height: auto; /* Adjust for smaller buttons if needed */
    }

    .btn-icon {
      padding: 0.25rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid #e2e8f0;
      color: #0f172a;
    }
     .btn-outline:hover:not(:disabled) {
        background-color: #f1f5f9; /* Slight background on hover */
    }

    .input {
      border-radius: 0.375rem;
      border: 1px solid #e2e8f0;
      font-size: 0.875rem;
      line-height: 1.25rem;
      padding: 0.5rem;
      width: 100%;
    }

    .input:focus {
      border-color: #3b82f6;
      outline: none;
       box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* Ring effect */
    }
     .input:disabled {
        cursor: not-allowed;
        background-color: #f8fafc;
        opacity: 0.7;
    }

    .dialog-backdrop {
      background-color: rgba(0, 0, 0, 0.5);
      inset: 0;
      position: fixed;
      z-index: 50;
    }

    .dialog-content {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      left: 50%;
      max-width: 28rem;
      padding: 1.5rem;
      position: fixed;
      top: 50%;
      transform: translate(-50%, -50%);
      width: calc(100% - 2rem);
      z-index: 51;
    }

    .dialog-header {
      margin-bottom: 1rem;
    }

    .dialog-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .tabs {
      display: flex;
      flex-direction: column;
    }

    .tabs-list {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 1rem;
    }

    .tabs-trigger {
      align-items: center;
      border-bottom: 2px solid transparent;
      color: #64748b;
      cursor: pointer;
      display: inline-flex;
      font-size: 0.875rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      transition: border-color 0.15s, color 0.15s;
      margin-bottom: -1px; /* Overlap border */
    }

    .tabs-trigger-active {
      border-bottom-color: #3b82f6;
      color: #3b82f6;
    }

    .tabs-content {
      display: none;
    }

    .tabs-content-active {
      display: block;
    }

    .select {
      border: 1px solid #e2e8f0;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      height: 2.5rem;
      padding: 0 0.75rem;
      width: 100%;
      background-color: white; /* Ensure background for select */
      cursor: pointer;
    }
    .select:focus {
       border-color: #3b82f6;
       outline: none;
       box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* Ring effect */
    }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <div id="root"></div>

  <script type="text/babel">
    // Create simplified versions of the shadcn components
    const Card = ({ children, className = "" }) => (
      <div className={`card ${className}`}>{children}</div>
    );

    const CardHeader = ({ children, className = "" }) => (
      <div className={`card-header ${className}`}>{children}</div>
    );

    const CardContent = ({ children, className = "" }) => (
      <div className={`card-content ${className}`}>{children}</div>
    );

    const CardTitle = ({ children, className = "" }) => (
      <h3 className={`card-title ${className}`}>{children}</h3>
    );

    const CardDescription = ({ children, className = "" }) => (
      <p className={`card-description ${className}`}>{children}</p>
    );

    const Badge = ({ children, variant = "default", className = "" }) => (
      <span className={`badge badge-${variant} ${className}`}>{children}</span>
    );

    const Button = ({
      children,
      variant = "primary",
      size = "default",
      className = "",
      onClick,
      disabled = false
    }) => (
      <button
        className={`btn btn-${variant} ${size === "sm" ? "btn-sm" : ""} ${size === "icon" ? "btn-icon" : ""} ${className}`}
        onClick={onClick}
        disabled={disabled}
      >
        {children}
      </button>
    );

    const Input = ({
      type = "text",
      value,
      onChange,
      placeholder,
      className = "",
      id,
      min,
      max,
      defaultValue,
      disabled = false
    }) => (
      <input
        type={type}
        value={value}
        onChange={onChange}
        placeholder={placeholder}
        className={`input ${className}`}
        id={id}
        min={min}
        max={max}
        defaultValue={defaultValue}
        disabled={disabled}
        step={type === 'number' ? ((placeholder && placeholder.toLowerCase().includes('price')) || (placeholder && placeholder.toLowerCase().includes('limit')) ? '0.01' : '1') : undefined}
      />
    );

    const Dialog = ({ children, open, onOpenChange }) => {
      if (!open) return null;

      return (
        <React.Fragment>
          <div className="dialog-backdrop" onClick={() => onOpenChange(false)} />
          <div className="dialog-content">
            {children}
          </div>
        </React.Fragment>
      );
    };

    const DialogTrigger = ({ children, onClick }) => {
        const child = React.Children.only(children);
        return React.cloneElement(child, {
            onClick: () => {
                if (onClick) onClick();
            }
        });
    };

    const DialogContent = ({ children }) => (
      <div>{children}</div>
    );

    const DialogHeader = ({ children }) => (
      <div className="dialog-header">{children}</div>
    );

    const DialogTitle = ({ children }) => (
      <h2 className="dialog-title">{children}</h2>
    );

    const Tabs = ({ children, defaultValue }) => {
      const [activeTab, setActiveTab] = React.useState(defaultValue);

      return (
        <div className="tabs">
          {React.Children.map(children, child => {
            if (React.isValidElement(child) && child.type) {
                 if (child.type === TabsList || child.type === TabsContent) {
                    return React.cloneElement(child, { activeTab, setActiveTab });
                 }
            }
            return child;
          })}
        </div>
      );
    };

    const TabsList = ({ children, activeTab, setActiveTab }) => (
      <div className="tabs-list">
        {React.Children.map(children, child => {
           if (React.isValidElement(child) && child.type === TabsTrigger) {
             return React.cloneElement(child, { activeTab, setActiveTab });
           }
           return child;
        })}
      </div>
    );

    const TabsTrigger = ({ children, value, activeTab, setActiveTab }) => (
      <div
        className={`tabs-trigger ${activeTab === value ? 'tabs-trigger-active' : ''}`}
        onClick={() => setActiveTab(value)}
        role="tab"
        aria-selected={activeTab === value}
        tabIndex={0}
        onKeyPress={(e) => { if (e.key === 'Enter' || e.key === ' ') setActiveTab(value); }}
      >
        {React.Children.map(children, child => {
             if (React.isValidElement(child) && child.props && typeof child.props.className === 'string' && child.props.className.includes('lucide')) {
                 return React.cloneElement(child, { size: 16, className: `${child.props.className} mr-2` });
             }
             return child;
        })}
      </div>
    );

    const TabsContent = ({ children, value, activeTab }) => (
      <div
        className={`tabs-content ${activeTab === value ? 'tabs-content-active' : ''}`}
        role="tabpanel"
        aria-labelledby={`tab-${value}`}
      >
        {children}
      </div>
    );

    const Select = ({ children, value, onValueChange, className = "" }) => (
      <select
        className={`select ${className}`}
        value={value}
        onChange={(e) => onValueChange(e.target.value)}
      >
        {children}
      </select>
    );

    const SelectValue = ({ placeholder }) => (
      <option value="" disabled hidden>{placeholder}</option>
    );

    const SelectItem = ({ children, value }) => (
      <option value={value}>{children}</option>
    );

    // Main component
    const BillingDashboard = () => {
      // Destructuring Lucide icons
       const { Trash: TrashIcon, Plus: PlusIcon, Minus: MinusIcon, Package: PackageIcon, Users2: Users2Icon, History: HistoryIcon, Percent: PercentIcon } = lucide;

      const initialItems = [
        { id: 1, name: "Item A", price: 100, quantity: 10, taxRate: 10 },
        { id: 2, name: "Item B", price: 200, quantity: 5, taxRate: 5 },
        { id: 3, name: "Item C", price: 150, quantity: 8, taxRate: 8 },
        { id: 4, name: "Low Stock D", price: 50, quantity: 2, taxRate: 15 },
      ];

      const initialCustomers = [
        { id: 1, name: "John Doe", phone: "555-1234", creditLimit: 1000, creditUsed: 200 },
        { id: 2, name: "Jane Smith", phone: "555-5678", creditLimit: 2000, creditUsed: 500 },
      ];

      const initialTransactions = [
        { id: 1, customerId: 1, items: [{ id: 1, name: "Item A", price: 100, quantity: 2, taxRate: 10 }], total: 220, tax: 20, paymentMode: "paid", date: "2025-03-28" },
        { id: 2, customerId: 2, items: [{ id: 2, name: "Item B", price: 200, quantity: 1, taxRate: 5 }], total: 210, tax: 10, paymentMode: "credit", date: "2025-03-29" },
        { id: 3, customerId: 1, items: [{ id: 3, name: "Item C", price: 150, quantity: 3, taxRate: 8 }], total: 486, tax: 36, paymentMode: "credit", date: "2025-03-30" },
      ];

      const [items, setItems] = React.useState(initialItems);
      const [cart, setCart] = React.useState([]);
      const [newItem, setNewItem] = React.useState({ name: "", price: "", quantity: "", taxRate: "" });
      const [searchTerm, setSearchTerm] = React.useState("");
      const [customers, setCustomers] = React.useState(initialCustomers);
      const [transactions, setTransactions] = React.useState(initialTransactions);
      const [selectedCustomer, setSelectedCustomer] = React.useState(null);
      const [newCustomer, setNewCustomer] = React.useState({ name: "", phone: "", creditLimit: "" });
      const [paymentMode, setPaymentMode] = React.useState("paid");
      const [addItemDialogOpen, setAddItemDialogOpen] = React.useState(false);
      const [addCustomerDialogOpen, setAddCustomerDialogOpen] = React.useState(false);

      const [itemQuantities, setItemQuantities] = React.useState({});

      React.useEffect(() => {
        const initialQuantities = items.reduce((acc, item) => {
          acc[item.id] = 1;
          return acc;
        }, {});
        setItemQuantities(initialQuantities);
      }, [items]);

      const handleItemQuantityChange = (itemId, value) => {
         const rawValue = value;
         const quantity = parseInt(value);
         setItemQuantities(prev => ({
             ...prev,
             [itemId]: isNaN(quantity) ? (rawValue === '' ? '' : 1) : Math.max(1, quantity)
         }));
     };

      const addToCart = (item) => {
         const quantityStr = itemQuantities[item.id]?.toString() ?? '1';
         const quantity = parseInt(quantityStr);

         if (isNaN(quantity) || quantity < 1 || quantityStr === '') {
             alert("Please enter a valid quantity (must be 1 or more)!");
             setItemQuantities(prev => ({ ...prev, [item.id]: 1 }));
             return;
         }

         const currentItemDetails = items.find(i => i.id === item.id);
         if (!currentItemDetails) {
             console.error("Item not found in inventory:", item.id);
             return;
         }

         if (quantity > currentItemDetails.quantity) {
           alert("Not enough stock available!");
           return;
         }

         setItems(prevItems => prevItems.map(i =>
           i.id === item.id ? { ...i, quantity: i.quantity - quantity } : i
         ));

         const existingItem = cart.find((c) => c.id === item.id);
         if (existingItem) {
           setCart(prevCart => prevCart.map((c) =>
             c.id === item.id ? { ...c, quantity: c.quantity + quantity } : c
           ));
         } else {
           setCart(prevCart => [...prevCart, {
               id: item.id,
               name: item.name,
               price: item.price,
               taxRate: item.taxRate,
               quantity: quantity
            }]);
         }
         setItemQuantities(prev => ({ ...prev, [item.id]: 1 }));
       };

      const removeFromCart = (itemId) => {
        const itemToRemove = cart.find(item => item.id === itemId);
        if (!itemToRemove) return;

        setItems(prevItems => prevItems.map(item =>
          item.id === itemId
            ? { ...item, quantity: item.quantity + itemToRemove.quantity }
            : item
        ));
        setCart(prevCart => prevCart.filter(item => item.id !== itemId));
      };

      const adjustQuantity = (itemId, amount) => {
        const itemInCart = cart.find(item => item.id === itemId);
        if (!itemInCart) return;

         const itemInStock = items.find(item => item.id === itemId);
         if (!itemInStock) {
             console.error("Adjusting quantity for item not in stock:", itemId);
             return;
         }

        if (amount > 0 && itemInStock.quantity < 1) {
          alert("No more stock available to increase quantity!");
          return;
        }

        const newCartQuantity = itemInCart.quantity + amount;

        if (newCartQuantity < 1) {
          removeFromCart(itemId);
          return;
        }

        setItems(prevItems => prevItems.map(item =>
          item.id === itemId
            ? { ...item, quantity: item.quantity - amount }
            : item
        ));
        setCart(prevCart => prevCart.map(item =>
          item.id === itemId
            ? { ...item, quantity: newCartQuantity }
            : item
        ));
      };

      const handleAddNewItem = () => {
        if (!newItem.name || !newItem.price || !newItem.quantity || !newItem.taxRate) {
          alert("Please fill all fields for the new item.");
          return;
        }
         const price = parseFloat(newItem.price);
         const quantity = parseInt(newItem.quantity);
         const taxRate = parseFloat(newItem.taxRate);

         if (isNaN(price) || price < 0 || isNaN(quantity) || quantity < 0 || isNaN(taxRate) || taxRate < 0) {
             alert("Please enter valid positive numbers for price, quantity, and tax rate.");
             return;
         }

        const newItemWithId = {
          id: (items.length ? Math.max(...items.map(item => item.id)) : 0) + 1,
          name: newItem.name.trim(),
          price: price,
          quantity: quantity,
          taxRate: taxRate
        };

        setItems([...items, newItemWithId]);
        setNewItem({ name: "", price: "", quantity: "", taxRate: "" });
        setAddItemDialogOpen(false);
      };

      const handleAddNewCustomer = () => {
        if (!newCustomer.name || !newCustomer.phone || !newCustomer.creditLimit) {
          alert("Please fill all customer fields.");
          return;
        }
         const creditLimit = parseFloat(newCustomer.creditLimit);
          if (isNaN(creditLimit) || creditLimit < 0) {
             alert("Please enter a valid positive number for the credit limit.");
             return;
         }

        const newCustomerWithId = {
           id: (customers.length ? Math.max(...customers.map(c => c.id)) : 0) + 1,
           name: newCustomer.name.trim(),
           phone: newCustomer.phone.trim(),
           creditLimit: creditLimit,
           creditUsed: 0
        };

        setCustomers([...customers, newCustomerWithId]);
        setNewCustomer({ name: "", phone: "", creditLimit: "" });
        setAddCustomerDialogOpen(false);
      };

      const calculateSubtotal = () => {
        return cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
      };
      const calculateTax = () => {
        return cart.reduce((acc, item) => acc + (item.price * item.quantity) * (item.taxRate / 100), 0);
      };
      const calculateTotal = () => calculateSubtotal() + calculateTax();

      const completePurchase = () => {
        if (!selectedCustomer) {
          alert("Please select a customer before completing the purchase.");
          return;
        }
        if (cart.length === 0) {
          alert("Cart is empty. Add items to proceed.");
          return;
        }
        const total = calculateTotal();
        if (paymentMode === "credit") {
          const newCreditUsed = selectedCustomer.creditUsed + total;
          if (newCreditUsed > selectedCustomer.creditLimit) {
            alert(`Purchase exceeds the customer's available credit limit ($${(selectedCustomer.creditLimit - selectedCustomer.creditUsed).toFixed(2)} available).`);
            return;
          }
          setCustomers(prevCustomers => prevCustomers.map(customer =>
            customer.id === selectedCustomer.id
              ? { ...customer, creditUsed: newCreditUsed }
              : customer
          ));
          setSelectedCustomer(prev => prev ? { ...prev, creditUsed: newCreditUsed } : null);
        }
        const newTransaction = {
          id: (transactions.length ? Math.max(...transactions.map(t => t.id)) : 0) + 1,
          customerId: selectedCustomer.id,
          items: [...cart],
          total: total,
          tax: calculateTax(),
          paymentMode: paymentMode,
          date: new Date().toISOString().split('T')[0]
        };
        setTransactions([...transactions, newTransaction]);
        setCart([]);
        alert(`Purchase completed successfully! Total: $${total.toFixed(2)} for ${selectedCustomer.name}.`);
      };

      const filteredItems = items.filter(item => item.name.toLowerCase().includes(searchTerm.toLowerCase()));
      const getCustomerById = (id) => customers.find(c => c.id === id);

      return (
        <div className="p-4 max-w-7xl mx-auto">
          <header className="mb-6">
            <h1 className="text-3xl font-bold text-gray-800">Billing Dashboard</h1>
            <p className="text-gray-600">Manage inventory, customer orders, and credit accounts.</p>
          </header>

          <Tabs defaultValue="billing">
            <TabsList>
              <TabsTrigger value="billing"><PackageIcon />Billing</TabsTrigger>
              <TabsTrigger value="customers"><Users2Icon />Customers</TabsTrigger>
              <TabsTrigger value="history"><HistoryIcon />Transaction History</TabsTrigger>
            </TabsList>

            {/* Billing Tab */}
            <TabsContent value="billing">
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Inventory Section */}
                <Card>
                  <CardHeader className="flex flex-col sm:flex-row items-start sm:items-center justify-between pb-4 border-b">
                    <div>
                      <CardTitle>Inventory</CardTitle>
                      <CardDescription>Available items for sale</CardDescription>
                    </div>
                     <Dialog open={addItemDialogOpen} onOpenChange={setAddItemDialogOpen}>
                         <DialogTrigger onClick={() => setAddItemDialogOpen(true)}>
                            <Button size="sm" className="mt-2 sm:mt-0"><PlusIcon className="h-4 w-4 mr-1"/> Add Item</Button>
                         </DialogTrigger>
                         <DialogContent>
                           <DialogHeader><DialogTitle>Add New Inventory Item</DialogTitle></DialogHeader>
                           <div className="space-y-3 mt-4">
                             <div className="space-y-1">
                               <label htmlFor="itemName" className="text-sm font-medium text-gray-700">Item Name</label>
                               <Input id="itemName" placeholder="e.g., Widget Pro" value={newItem.name} onChange={(e) => setNewItem({...newItem, name: e.target.value})} />
                             </div>
                             <div className="grid grid-cols-3 gap-3">
                                <div className="space-y-1">
                                 <label htmlFor="itemPrice" className="text-sm font-medium text-gray-700">Price ($)</label>
                                 <Input id="itemPrice" type="number" placeholder="0.00" value={newItem.price} onChange={(e) => setNewItem({...newItem, price: e.target.value})} />
                                </div>
                                <div className="space-y-1">
                                     <label htmlFor="itemQuantity" className="text-sm font-medium text-gray-700">Quantity</label>
                                     <Input id="itemQuantity" type="number" placeholder="0" value={newItem.quantity} onChange={(e) => setNewItem({...newItem, quantity: e.target.value})} />
                                 </div>
                                <div className="space-y-1">
                                    <label htmlFor="itemTaxRate" className="text-sm font-medium text-gray-700">Tax (%)</label>
                                    <Input id="itemTaxRate" type="number" placeholder="0.0" value={newItem.taxRate} onChange={(e) => setNewItem({...newItem, taxRate: e.target.value})} />
                                </div>
                            </div>
                             <div className="flex justify-end space-x-2 pt-4">
                                 <Button variant="outline" onClick={() => setAddItemDialogOpen(false)}>Cancel</Button>
                                 <Button onClick={handleAddNewItem}>Add to Inventory</Button>
                             </div>
                           </div>
                         </DialogContent>
                     </Dialog>
                  </CardHeader>
                  <CardContent>
                    <div className="mb-4"><Input placeholder="Search items by name..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /></div>
                    <div className="overflow-x-auto">
                      <div className="w-full border rounded-md text-sm">
                         <div className="grid grid-cols-6 bg-gray-50 p-2 font-semibold border-b text-gray-600">
                           <div className="col-span-2">Name</div><div className="text-right">Price</div><div className="text-center">Tax</div><div className="text-center">Stock</div><div className="text-right">Action</div>
                         </div>
                         <div className="divide-y max-h-96 overflow-y-auto">
                           {filteredItems.length > 0 ? filteredItems.map((item) => (
                             <div key={item.id} className="grid grid-cols-6 p-2 items-center hover:bg-gray-50 transition-colors">
                               <div className="col-span-2 font-medium">{item.name}</div><div className="text-right">${item.price.toFixed(2)}</div><div className="text-center">{item.taxRate}%</div>
                               <div className="text-center"><Badge variant={item.quantity > 3 ? "default" : (item.quantity > 0 ? "secondary" : "destructive")}>{item.quantity}</Badge></div>
                               <div className="flex justify-end items-center space-x-2">
                                     <Input type="number" min="1" max={item.quantity > 0 ? item.quantity : undefined} value={itemQuantities[item.id] || '1'} onChange={(e) => handleItemQuantityChange(item.id, e.target.value)} id={`qty-${item.id}`} className="w-14 h-8 text-sm p-1 text-center" disabled={item.quantity < 1} />
                                     <Button size="sm" variant="primary" className="h-8 w-14" disabled={item.quantity < 1 || !itemQuantities[item.id] || parseInt(itemQuantities[item.id] || '0') < 1 } onClick={() => addToCart(item)}>Add</Button>
                               </div>
                             </div>
                           )) : <div className="p-4 text-center text-gray-500 col-span-6">No items match your search.</div>}
                         </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                {/* Cart Section */}
                <Card>
                  <CardHeader className="border-b pb-4">
                    <CardTitle>Customer Cart</CardTitle>
                     <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                          <label htmlFor="customerSelect" className="text-sm font-medium text-gray-700 block mb-1">Select Customer</label>
                          <Select 
                            value={selectedCustomer ? selectedCustomer.id.toString() : ""}
                            onValueChange={(value) => setSelectedCustomer(customers.find(c => c.id === parseInt(value)))}
                            className="w-full"
                          >
                            <SelectValue placeholder="Select a customer..." />
                            {customers.map((customer) => (
                              <SelectItem key={customer.id} value={customer.id.toString()}>
                                {customer.name}
                              </SelectItem>
                            ))}
                          </Select>
                        </div>
                        <div>
                          <Dialog open={addCustomerDialogOpen} onOpenChange={setAddCustomerDialogOpen}>
                            <DialogTrigger onClick={() => setAddCustomerDialogOpen(true)}>
                              <Button variant="outline" className="w-full"><PlusIcon className="h-4 w-4 mr-1"/> Add New Customer</Button>
                            </DialogTrigger>
                            <DialogContent>
                              <DialogHeader><DialogTitle>Add New Customer</DialogTitle></DialogHeader>
                              <div className="space-y-3 mt-4">
                                <div className="space-y-1">
                                  <label htmlFor="customerName" className="text-sm font-medium text-gray-700">Full Name</label>
                                  <Input id="customerName" placeholder="John Doe" value={newCustomer.name} onChange={(e) => setNewCustomer({...newCustomer, name: e.target.value})} />
                                </div>
                                <div className="space-y-1">
                                  <label htmlFor="customerPhone" className="text-sm font-medium text-gray-700">Phone Number</label>
                                  <Input id="customerPhone" placeholder="555-1234" value={newCustomer.phone} onChange={(e) => setNewCustomer({...newCustomer, phone: e.target.value})} />
                                </div>
                                <div className="space-y-1">
                                  <label htmlFor="customerCreditLimit" className="text-sm font-medium text-gray-700">Credit Limit ($)</label>
                                  <Input id="customerCreditLimit" type="number" placeholder="1000.00" value={newCustomer.creditLimit} onChange={(e) => setNewCustomer({...newCustomer, creditLimit: e.target.value})} />
                                </div>
                                <div className="flex justify-end space-x-2 pt-4">
                                  <Button variant="outline" onClick={() => setAddCustomerDialogOpen(false)}>Cancel</Button>
                                  <Button onClick={handleAddNewCustomer}>Add Customer</Button>
                                </div>
                              </div>
                            </DialogContent>
                          </Dialog>
                        </div>
                      </div>
                  </CardHeader>
                  <CardContent>
                    <div>
                      {selectedCustomer && (
                        <div className="bg-gray-50 p-3 rounded-md mb-4 flex justify-between items-center">
                          <div>
                            <span className="font-semibold">{selectedCustomer.name}</span>
                            <p className="text-sm text-gray-500">{selectedCustomer.phone}</p>
                          </div>
                          <div className="text-right">
                            <div className="text-sm text-gray-500">Credit Limit: ${selectedCustomer.creditLimit.toFixed(2)}</div>
                            <div className="text-sm">Available: ${(selectedCustomer.creditLimit - selectedCustomer.creditUsed).toFixed(2)}</div>
                          </div>
                        </div>
                      )}

                      <div className="space-y-1 mb-4">
                        <label htmlFor="paymentMode" className="text-sm font-medium text-gray-700">Payment Mode</label>
                        <Select value={paymentMode} onValueChange={setPaymentMode} className="w-full">
                          <SelectItem value="paid">Pay Now</SelectItem>
                          <SelectItem value="credit">Credit Account</SelectItem>
                        </Select>
                      </div>

                      <div className="border rounded-md mb-4">
                        <div className="grid grid-cols-7 bg-gray-50 p-2 text-sm font-semibold border-b text-gray-600">
                          <div className="col-span-2">Item</div>
                          <div className="text-right">Price</div>
                          <div className="text-center">Qty</div>
                          <div className="text-center">Tax</div>
                          <div className="text-right">Subtotal</div>
                          <div className="text-right">Action</div>
                        </div>
                        <div className="divide-y max-h-60 overflow-y-auto">
                          {cart.length > 0 ? cart.map((item) => (
                            <div key={item.id} className="grid grid-cols-7 p-2 items-center text-sm">
                              <div className="col-span-2 font-medium">{item.name}</div>
                              <div className="text-right">${item.price.toFixed(2)}</div>
                              <div className="flex items-center justify-center gap-1">
                                <Button size="sm" variant="outline" className="h-6 w-6 p-0" onClick={() => adjustQuantity(item.id, -1)}><MinusIcon className="h-3 w-3" /></Button>
                                <span className="w-6 text-center">{item.quantity}</span>
                                <Button size="sm" variant="outline" className="h-6 w-6 p-0" onClick={() => adjustQuantity(item.id, 1)}><PlusIcon className="h-3 w-3" /></Button>
                              </div>
                              <div className="text-center">{item.taxRate}%</div>
                              <div className="text-right">${(item.price * item.quantity).toFixed(2)}</div>
                              <div className="text-right">
                                <Button size="sm" variant="destructive" className="h-7 p-1" onClick={() => removeFromCart(item.id)}><TrashIcon className="h-4 w-4" /></Button>
                              </div>
                            </div>
                          )) : (
                            <div className="p-4 text-center text-gray-500 col-span-7">Cart is empty. Add items from inventory.</div>
                          )}
                        </div>
                      </div>

                      <div className="space-y-2 mt-4">
                        <div className="flex justify-between text-sm">
                          <span>Subtotal:</span>
                          <span>${calculateSubtotal().toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between text-sm">
                          <span>Tax:</span>
                          <span>${calculateTax().toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between font-semibold pt-2 border-t">
                          <span>Total:</span>
                          <span>${calculateTotal().toFixed(2)}</span>
                        </div>
                        <Button className="w-full mt-4" onClick={completePurchase} disabled={!selectedCustomer || cart.length === 0}>
                          Complete {paymentMode === "credit" ? "Credit Purchase" : "Payment"}
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>

            {/* Customers Tab */}
            <TabsContent value="customers">
              <Card>
                <CardHeader>
                  <CardTitle>Customer Management</CardTitle>
                  <CardDescription>View and manage customer accounts and credit balances.</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse">
                      <thead>
                        <tr className="bg-gray-50 text-left">
                          <th className="p-3 border-b">Name</th>
                          <th className="p-3 border-b">Phone</th>
                          <th className="p-3 border-b">Credit Limit</th>
                          <th className="p-3 border-b">Credit Used</th>
                          <th className="p-3 border-b">Available Credit</th>
                        </tr>
                      </thead>
                      <tbody>
                        {customers.map((customer) => (
                          <tr key={customer.id} className="hover:bg-gray-50">
                            <td className="p-3 border-b font-medium">{customer.name}</td>
                            <td className="p-3 border-b">{customer.phone}</td>
                            <td className="p-3 border-b">${customer.creditLimit.toFixed(2)}</td>
                            <td className="p-3 border-b">${customer.creditUsed.toFixed(2)}</td>
                            <td className="p-3 border-b">
                              <Badge variant={customer.creditLimit - customer.creditUsed > 0.2 * customer.creditLimit ? "default" : "destructive"}>
                                ${(customer.creditLimit - customer.creditUsed).toFixed(2)}
                              </Badge>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Transaction History Tab */}
            <TabsContent value="history">
              <Card>
                <CardHeader>
                  <CardTitle>Transaction History</CardTitle>
                  <CardDescription>View all past transactions and billing records.</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse">
                      <thead>
                        <tr className="bg-gray-50 text-left">
                          <th className="p-3 border-b">Date</th>
                          <th className="p-3 border-b">Customer</th>
                          <th className="p-3 border-b">Items</th>
                          <th className="p-3 border-b">Tax</th>
                          <th className="p-3 border-b">Total</th>
                          <th className="p-3 border-b">Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {transactions.map((transaction) => {
                          const customer = getCustomerById(transaction.customerId);
                          return (
                            <tr key={transaction.id} className="hover:bg-gray-50">
                              <td className="p-3 border-b">{transaction.date}</td>
                              <td className="p-3 border-b font-medium">{customer ? customer.name : "Unknown"}</td>
                              <td className="p-3 border-b">{transaction.items.length} items</td>
                              <td className="p-3 border-b">${transaction.tax.toFixed(2)}</td>
                              <td className="p-3 border-b font-semibold">${transaction.total.toFixed(2)}</td>
                              <td className="p-3 border-b">
                                <Badge variant={transaction.paymentMode === "paid" ? "default" : "secondary"}>
                                  {transaction.paymentMode === "paid" ? "Paid" : "On Credit"}
                                </Badge>
                              </td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                </CardContent>
              </Card>
            </TabsContent>
          </Tabs>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<BillingDashboard />);
  </script>
</body>
</html>
